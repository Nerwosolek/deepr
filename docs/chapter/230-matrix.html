<!DOCTYPE html>


<html class="writer-html5" lang="en" >
<!-- Copyright (C) 2020-2022, Marek Gagolewski <https://www.gagolewski.com> -->

<head>
  <meta charset="utf-8" />

  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<meta content="Deep R Programming" name="citation_title" />
<meta content="Marek Gagolewski" name="citation_author" />
<meta content="2023" name="citation_date" />
<meta content="2023" name="citation_publication_date" />
<meta content="https://deepr.gagolewski.com/deepr.pdf" name="citation_pdf_url" />
<meta content="https://deepr.gagolewski.com/" name="citation_public_url" />
<meta content="10.5281/zenodo.7490464" name="citation_doi" />
<meta content="Deep R Programming is comprehensive course on one of the most popular languages in data science (statistical computing, graphics, machine learning, data wrangling and analytics). It introduces the base language in-depth and is aimed at ambitious students, practitioners, and researchers who would like to become independent users of this powerful environment. This textbook is a non-profit project. Its online and PDF versions are freely available at https://deepr.gagolewski.com/." name="citation_abstract" />
<meta content="summary" name="twitter:card" />
<meta content="Deep R Programming" name="twitter:title" />
<meta content="Deep R Programming" name="og:title" />
<meta content="Deep R Programming is comprehensive course on one of the most popular languages in data science (statistical computing, graphics, machine learning, data wrangling and analytics). It introduces the base language in-depth and is aimed at ambitious students, practitioners, and researchers who would like to become independent users of this powerful environment. This textbook is a non-profit project. Its online and PDF versions are freely available at https://deepr.gagolewski.com/." name="twitter:description" />
<meta content="Deep R Programming is comprehensive course on one of the most popular languages in data science (statistical computing, graphics, machine learning, data wrangling and analytics). It introduces the base language in-depth and is aimed at ambitious students, practitioners, and researchers who would like to become independent users of this powerful environment. This textbook is a non-profit project. Its online and PDF versions are freely available at https://deepr.gagolewski.com/." name="og:description" />
<meta content="gagolews/deepr" name="og:site_name" />
<meta content="https://deepr.gagolewski.com/" name="og:url" />
<meta content="https://deepr.gagolewski.com/_images/cover.png" name="twitter:image" />
<meta content="https://deepr.gagolewski.com/_images/cover.png" name="og:image" />
<meta content="https://deepr.gagolewski.com/" name="DC.identifier" />
<meta content="Marek Gagolewski" name="DC.publisher" />
<meta content="INDEX,FOLLOW" name="robots" />
<meta content="book" name="og:type" />
<meta content="9780645571929" name="og:book:isbn" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>11. Matrices and Other Arrays &mdash; Deep R Programming by Marek Gagolewski</title>
  

  
  
  <script async defer src="https://buttons.github.io/buttons.js"></script>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/proof.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/favicon.png"/>
  

  
  

  
    <link rel="canonical" href="https://deepr.gagolewski.com/chapter/230-matrix.html" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/proof.js"></script>
        <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="12. Data Frames" href="240-data-frame.html" />
    <link rel="prev" title="10. S3 Classes" href="220-s3.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html"> Deep R Programming
          

          
          </a>

          <div class="version">
          An Open-Access Textbook<br />    by <a style="color: inherit" href="https://www.gagolewski.com">Marek     Gagolewski</a><br />    v0.1.12 (draft)
          </div>

<!--
          
            
            
              <div class="version">
                by Marek Gagolewski
              </div>
            
          
-->

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search phrase..." />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">About</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.gagolewski.com/">Author</a></li>
<li class="toctree-l1"><a class="reference external" href="https://deepr.gagolewski.com/deepr.pdf">This Book in PDF</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/gagolews/deepr/">Report Bugs or Typos (GitHub)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/gagolews/teaching-data">Datasets</a></li>
<li class="toctree-l1"><a class="reference external" href="https://datawranglingpy.gagolewski.com">Data Wrangling with Python</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Start Here</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="000-preface.html">Preface</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Deep</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="110-basics.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="120-numeric.html">2. Numeric Vectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="130-logical.html">3. Logical Vectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="140-list.html">4. Lists and Attributes</a></li>
<li class="toctree-l1"><a class="reference internal" href="150-indexing.html">5. Vector Indexing</a></li>
<li class="toctree-l1"><a class="reference internal" href="160-character.html">6. Character Vectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="170-function.html">7. Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="180-flow.html">8. Flow of Execution</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Deeper</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="210-design.html">9. Designing Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="220-s3.html">10. S3 Classes</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">11. Matrices and Other Arrays</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#creating-arrays">11.1. Creating Arrays</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#matrix-and-array">11.1.1. <strong class="command">matrix</strong> and <strong class="command">array</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#promoting-and-stacking-vectors">11.1.2. Promoting and Stacking Vectors</a></li>
<li class="toctree-l3"><a class="reference internal" href="#simplifying-lists">11.1.3. Simplifying Lists</a></li>
<li class="toctree-l3"><a class="reference internal" href="#beyond-numeric-arrays">11.1.4. Beyond Numeric Arrays</a></li>
<li class="toctree-l3"><a class="reference internal" href="#internal-representation">11.1.5. Internal Representation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#array-indexing">11.2. Array Indexing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#arrays-are-built-upon-basic-vectors">11.2.1. Arrays Are Built upon Basic Vectors</a></li>
<li class="toctree-l3"><a class="reference internal" href="#selecting-individual-elements">11.2.2. Selecting Individual Elements</a></li>
<li class="toctree-l3"><a class="reference internal" href="#selecting-rows-and-columns">11.2.3. Selecting Rows and Columns</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dropping-dimensions">11.2.4. Dropping Dimensions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#selecting-submatrices">11.2.5. Selecting Submatrices</a></li>
<li class="toctree-l3"><a class="reference internal" href="#selecting-elements-based-on-logical-vectors">11.2.6. Selecting Elements Based on Logical Vectors</a></li>
<li class="toctree-l3"><a class="reference internal" href="#selecting-based-on-two-column-numeric-matrices">11.2.7. Selecting Based on Two-Column Numeric Matrices</a></li>
<li class="toctree-l3"><a class="reference internal" href="#higher-dimensional-arrays">11.2.8. Higher-Dimensional Arrays</a></li>
<li class="toctree-l3"><a class="reference internal" href="#replacing-elements">11.2.9. Replacing Elements</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#common-operations">11.3. Common Operations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#matrix-transpose">11.3.1. Matrix Transpose</a></li>
<li class="toctree-l3"><a class="reference internal" href="#vectorised-mathematical-functions">11.3.2. Vectorised Mathematical Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#aggregating-rows-and-columns">11.3.3. Aggregating Rows and Columns</a></li>
<li class="toctree-l3"><a class="reference internal" href="#binary-operators">11.3.4. Binary Operators</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#numerical-matrix-algebra">11.4. Numerical Matrix Algebra (*)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#matrix-multiplication">11.4.1. Matrix Multiplication</a></li>
<li class="toctree-l3"><a class="reference internal" href="#solving-systems-of-linear-equations">11.4.2. Solving Systems of Linear Equations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#norms-and-metrics">11.4.3. Norms and Metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="#eigenvalues-and-eigenvectors">11.4.4. Eigenvalues and Eigenvectors</a></li>
<li class="toctree-l3"><a class="reference internal" href="#qr-decomposition">11.4.5. QR Decomposition</a></li>
<li class="toctree-l3"><a class="reference internal" href="#svd-decomposition">11.4.6. SVD Decomposition</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#s4-classes">11.5. S4 Classes (*)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#defining-s4-classes">11.5.1. Defining S4 Classes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#accessing-slots">11.5.2. Accessing Slots</a></li>
<li class="toctree-l3"><a class="reference internal" href="#defining-methods">11.5.3. Defining Methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="#defining-constructors">11.5.4. Defining Constructors</a></li>
<li class="toctree-l3"><a class="reference internal" href="#inheritance">11.5.5. Inheritance</a></li>
<li class="toctree-l3"><a class="reference internal" href="#a-note-on-the-matrix-package">11.5.6. A Note on the <strong class="program">Matrix</strong> Package</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#exercises">11.6. Exercises</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="240-data-frame.html">12. Data Frames</a></li>
<li class="toctree-l1"><a class="reference internal" href="250-graphics.html">13. 🚧 Graphics</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Deepest</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="310-compile.html">14. 🚧 Interfacing Compiled Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="320-language.html">15. 🚧 Expressions</a></li>
<li class="toctree-l1"><a class="reference internal" href="330-environment.html">16. 🚧 Environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="340-eval-expr.html">17. 🚧 Evaluating Expressions</a></li>
<li class="toctree-l1"><a class="reference internal" href="350-eval-fun.html">18. 🚧 Evaluating Functions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Appendix</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="998-changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="999-bibliography.html">References</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Deep R Programming</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          



















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li><span class="section-number">11. </span>Matrices and Other Arrays</li>
    
    
      <li class="wy-breadcrumbs-aside">

        
        
        <a class="github-button" href="https://github.com/gagolews/deepr" data-icon="octicon-star" data-size="large" data-show-count="true" aria-label="Star gagolews/deepr on GitHub">GitHub</a>
        


        
      </li>
    
  </ul>

  
  <div class="rst-breadcrumbs-buttons" role="navigation" aria-label="breadcrumb navigation">
      
        <a href="240-data-frame.html" class="btn btn-neutral float-right" title="12. Data Frames" accesskey="n">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
      
      
        <a href="220-s3.html" class="btn btn-neutral float-left" title="10. S3 Classes" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
      
  </div>
  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section class="tex2jax_ignore mathjax_ignore" id="matrices-and-other-arrays">
<span id="chap-matrix"></span><h1><span class="section-number">11. </span>Matrices and Other Arrays<a class="headerlink" href="#matrices-and-other-arrays" title="Permalink to this heading"></a></h1>
<blockquote>
<div><p><em>The open-access textbook</em>
Deep R Programming <em>by <a class="reference external" href="https://www.gagolewski.com">Marek Gagolewski</a>
is, and will remain, freely available for everyone’s enjoyment
(also in <a class="reference external" href="https://deepr.gagolewski.com/deepr.pdf">PDF</a>).
It is a non-profit project.</em>
<strong>This book is still a work in progress. Beta versions
of Chapters 1–12 are already complete, but there will be more.
In the meantime, any
<a class="reference external" href="https://github.com/gagolews/deepr/issues">bug/typos reports/fixes</a>
are appreciated.</strong>
<em>Although available online, it is a whole course;
it should be read from the beginning to the end.
Refer to the <a class="reference internal" href="000-preface.html#chap-preface"><span class="std std-ref">Preface</span></a> for general introductory remarks.</em>
<em>Also, check out my other book, <a class="reference external" href="https://datawranglingpy.gagolewski.com/"><em>Minimalist Data Wrangling with Python</em></a> <span id="id1">[<a class="reference internal" href="999-bibliography.html#id3" title="Gagolewski, M. (2022).  Minimalist Data Wrangling with Python. Zenodo, Melbourne. ISBN 978-0-6455719-1-2. URL: https://datawranglingpy.gagolewski.com/, DOI: 10.5281/zenodo.6451068.">20</a>]</span>.</em></p>
</div></blockquote>
<p>When we equip an atomic or generic vector with the <code class="docutils literal notranslate"><span class="pre">dim</span></code> attribute,
it automatically becomes an object of S3 class <code class="docutils literal notranslate"><span class="pre">array</span></code>.
In particular, two-dimensional arrays (primary S3 class <code class="docutils literal notranslate"><span class="pre">matrix</span></code>) allow us
to represent <em>tabular</em> data where items are aligned into rows and columns:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">structure</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">6</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">))</span>  <span class="c1"># a matrix with 2 rows and 3 columns</span>
<span class="c1">##      [,1] [,2] [,3]</span>
<span class="c1">## [1,]    1    3    5</span>
<span class="c1">## [2,]    2    4    6</span>
</pre></div>
</div>
<p>This (combined with the fact that there are many built-in
functions overloaded for the <code class="docutils literal notranslate"><span class="pre">matrix</span></code> class)  opens up a range of new
possibilities, which we explore in this chapter.
In particular, we discuss how to perform basic algebraic operations
such as matrix multiplication, transpose, finding eigenvalues,
and performing various decompositions. We also cover data wrangling
operations such as array subsetting and column- and rowwise aggregation.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Oftentimes, a numeric matrix with <em>n</em> rows and <em>m</em>
will be used to represent <em>n</em> points (samples)
in an <em>m</em>-dimensional (with <em>m</em> features or variables)
space, <span class="math notranslate nohighlight">\(\mathbb{R}^m\)</span>.</p>
</div>
<p>Furthermore, in the next chapter, we will introduce data frames:
matrix-like objects whose columns can be of any (not necessarily
the same) type.</p>
<section id="creating-arrays">
<h2><span class="section-number">11.1. </span>Creating Arrays<a class="headerlink" href="#creating-arrays" title="Permalink to this heading"></a></h2>
<section id="matrix-and-array">
<h3><span class="section-number">11.1.1. </span><strong class="command">matrix</strong> and <strong class="command">array</strong><a class="headerlink" href="#matrix-and-array" title="Permalink to this heading"></a></h3>
<p>A matrix can be conveniently created by means
of the <strong class="command">matrix</strong> function.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">A</span> <span class="o">&lt;-</span> <span class="nf">matrix</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">6</span><span class="p">,</span> <span class="n">byrow</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">nrow</span><span class="o">=</span><span class="m">2</span><span class="p">))</span>
<span class="c1">##      [,1] [,2] [,3]</span>
<span class="c1">## [1,]    1    2    3</span>
<span class="c1">## [2,]    4    5    6</span>
</pre></div>
</div>
<p>The above converted an atomic vector of length six
into a matrix with two rows. The number of columns
was determined automatically (<code class="docutils literal notranslate"><span class="pre">ncol=3</span></code> could have been passed
to get the same result).</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>By default, the elements of the input vector are read columnwisely:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">matrix</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">6</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="m">3</span><span class="p">)</span>  <span class="c1"># byrow=FALSE</span>
<span class="c1">##      [,1] [,2] [,3]</span>
<span class="c1">## [1,]    1    3    5</span>
<span class="c1">## [2,]    2    4    6</span>
</pre></div>
</div>
</div>
<p>A matrix can be equipped with dimension names,
being a list of two character vectors of appropriate sizes,
labelling each row and column, in this order:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">matrix</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">6</span><span class="p">,</span> <span class="n">byrow</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">nrow</span><span class="o">=</span><span class="m">2</span><span class="p">,</span> <span class="n">dimnames</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">,</span> <span class="s">&quot;y&quot;</span><span class="p">),</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="s">&quot;b&quot;</span><span class="p">,</span> <span class="s">&quot;c&quot;</span><span class="p">)))</span>
<span class="c1">##   a b c</span>
<span class="c1">## x 1 2 3</span>
<span class="c1">## y 4 5 6</span>
</pre></div>
</div>
<p>Alternatively, to create a matrix, we can use the <strong class="command">array</strong> function,
which requires the number of rows and columns be specified explicitly.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">array</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">6</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">))</span>
<span class="c1">##      [,1] [,2] [,3]</span>
<span class="c1">## [1,]    1    3    5</span>
<span class="c1">## [2,]    2    4    6</span>
</pre></div>
</div>
<p>Note that the elements are consumed in a column-major manner.</p>
<p>Arrays of dimensionality other than 2 are also possible.
Here is a one-dimensional array. When printed, it is indistinguishable
from an atomic vector (but still the <code class="docutils literal notranslate"><span class="pre">class</span></code> attribute is
set to <code class="docutils literal notranslate"><span class="pre">array</span></code>):</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">array</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">6</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="m">6</span><span class="p">)</span>
<span class="c1">## [1] 1 2 3 4 5 6</span>
</pre></div>
</div>
<p>And now for something completely different: a three-dimensional array
of size 3-by-4-by-2</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">array</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">24</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">2</span><span class="p">))</span>
<span class="c1">## , , 1</span>
<span class="c1">## </span>
<span class="c1">##      [,1] [,2] [,3] [,4]</span>
<span class="c1">## [1,]    1    4    7   10</span>
<span class="c1">## [2,]    2    5    8   11</span>
<span class="c1">## [3,]    3    6    9   12</span>
<span class="c1">## </span>
<span class="c1">## , , 2</span>
<span class="c1">## </span>
<span class="c1">##      [,1] [,2] [,3] [,4]</span>
<span class="c1">## [1,]   13   16   19   22</span>
<span class="c1">## [2,]   14   17   20   23</span>
<span class="c1">## [3,]   15   18   21   24</span>
</pre></div>
</div>
<p>which can be thought of as two matrices of size 3-by-4
(because how else can we print out a 3D object on a 2D console?).</p>
<p>The <strong class="command">array</strong> function can be fed with the <code class="docutils literal notranslate"><span class="pre">dimnames</span></code> argument
too. For instance, the above three-dimensional hypertable
would require a list of three character vectors,
of sizes 3, 4, and 2, respectively.</p>
<div class="proof proof-type-exercise" id="id23">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.1</span>
        
    </div><div class="proof-content">
<p>That 10-dimensional arrays are also possible
the reader is encouraged to try out themself.</p>
</div></div></section>
<section id="promoting-and-stacking-vectors">
<span id="sec-cbind-matrix"></span><h3><span class="section-number">11.1.2. </span>Promoting and Stacking Vectors<a class="headerlink" href="#promoting-and-stacking-vectors" title="Permalink to this heading"></a></h3>
<p>We can promote an ordinary vector to a column vector, i.e.,
a matrix with one column by calling:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">as.matrix</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">)</span>
<span class="c1">##      [,1]</span>
<span class="c1">## [1,]    1</span>
<span class="c1">## [2,]    2</span>
<span class="nf">cbind</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">)</span>
<span class="c1">##      [,1]</span>
<span class="c1">## [1,]    1</span>
<span class="c1">## [2,]    2</span>
</pre></div>
</div>
<p>and to a row vector:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">t</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">)</span>  <span class="c1"># transpose</span>
<span class="c1">##      [,1] [,2] [,3]</span>
<span class="c1">## [1,]    1    2    3</span>
<span class="nf">rbind</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">)</span>
<span class="c1">##      [,1] [,2] [,3]</span>
<span class="c1">## [1,]    1    2    3</span>
</pre></div>
</div>
<p>Actually, <strong class="command">cbind</strong> and <strong class="command">rbind</strong> stand for column- and
row-bind; they allow multiple vectors and matrices be stacked
one after/below another:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">rbind</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">,</span> <span class="m">5</span><span class="o">:</span><span class="m">8</span><span class="p">,</span> <span class="m">9</span><span class="o">:</span><span class="m">10</span><span class="p">,</span> <span class="m">11</span><span class="p">)</span>  <span class="c1"># row bind</span>
<span class="c1">##      [,1] [,2] [,3] [,4]</span>
<span class="c1">## [1,]    1    2    3    4</span>
<span class="c1">## [2,]    5    6    7    8</span>
<span class="c1">## [3,]    9   10    9   10</span>
<span class="c1">## [4,]   11   11   11   11</span>
<span class="nf">cbind</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">,</span> <span class="m">5</span><span class="o">:</span><span class="m">8</span><span class="p">,</span> <span class="m">9</span><span class="o">:</span><span class="m">10</span><span class="p">,</span> <span class="m">11</span><span class="p">)</span>  <span class="c1"># column bind</span>
<span class="c1">##      [,1] [,2] [,3] [,4]</span>
<span class="c1">## [1,]    1    5    9   11</span>
<span class="c1">## [2,]    2    6   10   11</span>
<span class="c1">## [3,]    3    7    9   11</span>
<span class="c1">## [4,]    4    8   10   11</span>
<span class="nf">cbind</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="o">:</span><span class="m">4</span><span class="p">,</span> <span class="nf">rbind</span><span class="p">(</span><span class="m">11</span><span class="o">:</span><span class="m">13</span><span class="p">,</span> <span class="m">21</span><span class="o">:</span><span class="m">23</span><span class="p">))</span>  <span class="c1"># vector, vector, 2x3 matrix</span>
<span class="c1">##      [,1] [,2] [,3] [,4] [,5]</span>
<span class="c1">## [1,]    1    3   11   12   13</span>
<span class="c1">## [2,]    2    4   21   22   23</span>
</pre></div>
</div>
<p>and so forth.</p>
<p>Unfortunately, the <em>generalised</em>
recycling rule is not implemented in full:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">cbind</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">,</span> <span class="m">5</span><span class="o">:</span><span class="m">8</span><span class="p">,</span> <span class="nf">cbind</span><span class="p">(</span><span class="m">9</span><span class="o">:</span><span class="m">10</span><span class="p">,</span> <span class="m">11</span><span class="p">))</span>  <span class="c1"># different than cbind(1:4, 5:8, 9:10, 11)</span>
<span class="c1">## Warning in cbind(1:4, 5:8, cbind(9:10, 11)): number of rows of result is</span>
<span class="c1">## not a multiple of vector length (arg 1)</span>
<span class="c1">##      [,1] [,2] [,3] [,4]</span>
<span class="c1">## [1,]    1    5    9   11</span>
<span class="c1">## [2,]    2    6   10   11</span>
</pre></div>
</div>
<p>Note that the first two arguments are of length four.</p>
</section>
<section id="simplifying-lists">
<span id="sec-simplify2array"></span><h3><span class="section-number">11.1.3. </span>Simplifying Lists<a class="headerlink" href="#simplifying-lists" title="Permalink to this heading"></a></h3>
<p><strong class="command">simplify2array</strong> is an extension of the <strong class="command">unlist</strong> function.
Given a list of atomic vectors, each of length one, it will return a flat
atomic vector.
However, if a list of equisized vectors of greater lengths is given,
these will be converted to a matrix.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">simplify2array</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">11</span><span class="p">,</span> <span class="m">21</span><span class="p">))</span>  <span class="c1"># each of length 1</span>
<span class="c1">## [1]  1 11 21</span>
<span class="nf">simplify2array</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">,</span> <span class="m">11</span><span class="o">:</span><span class="m">13</span><span class="p">,</span> <span class="m">21</span><span class="o">:</span><span class="m">23</span><span class="p">,</span> <span class="m">31</span><span class="o">:</span><span class="m">33</span><span class="p">))</span>  <span class="c1"># each of length 3</span>
<span class="c1">##      [,1] [,2] [,3] [,4]</span>
<span class="c1">## [1,]    1   11   21   31</span>
<span class="c1">## [2,]    2   12   22   32</span>
<span class="c1">## [3,]    3   13   23   33</span>
<span class="nf">simplify2array</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">11</span><span class="o">:</span><span class="m">12</span><span class="p">,</span> <span class="m">21</span><span class="o">:</span><span class="m">23</span><span class="p">))</span>  <span class="c1"># no can do</span>
<span class="c1">## [[1]]</span>
<span class="c1">## [1] 1</span>
<span class="c1">## </span>
<span class="c1">## [[2]]</span>
<span class="c1">## [1] 11 12</span>
<span class="c1">## </span>
<span class="c1">## [[3]]</span>
<span class="c1">## [1] 21 22 23</span>
</pre></div>
</div>
<p>Note that in the second example, each vector becomes
a separate column of the resulting matrix<a class="footnote-reference brackets" href="#footsimplify" id="id2">1</a>.</p>
<p>See <a class="reference internal" href="240-data-frame.html#sec-df-group-by"><span class="std std-numref">Section 12.3.7</span></a> for a few more examples.</p>
<div class="proof proof-type-example" id="id24">

    <div class="proof-title">
        <span class="proof-type">Example 11.2</span>
        
    </div><div class="proof-content">
<p>There are quite a few functions that call the above automatically
by default (compare the <code class="docutils literal notranslate"><span class="pre">simplify</span></code> or <code class="docutils literal notranslate"><span class="pre">SIMPLIFY</span></code> (sic!) argument in
<strong class="command">sapply</strong>, <strong class="command">tapply</strong>, <strong class="command">mapply</strong>,
<strong class="command">replicate</strong>, etc.).</p>
<p>For instance:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">min_mean_max</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="nf">c</span><span class="p">(</span><span class="n">Min</span><span class="o">=</span><span class="nf">min</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">Mean</span><span class="o">=</span><span class="nf">mean</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">Max</span><span class="o">=</span><span class="nf">max</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="nf">sapply</span><span class="p">(</span><span class="nf">split</span><span class="p">(</span><span class="n">iris</span><span class="p">[[</span><span class="s">&quot;Sepal.Length&quot;</span><span class="p">]],</span> <span class="n">iris</span><span class="p">[[</span><span class="s">&quot;Species&quot;</span><span class="p">]]),</span> <span class="n">min_mean_max</span><span class="p">)</span>
<span class="c1">##      setosa versicolor virginica</span>
<span class="c1">## Min   4.300      4.900     4.900</span>
<span class="c1">## Mean  5.006      5.936     6.588</span>
<span class="c1">## Max   5.800      7.000     7.900</span>
</pre></div>
</div>
<p>Take note of what constitutes the columns of the return matrix.</p>
</div></div><div class="proof proof-type-exercise" id="id25">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.3</span>
        
    </div><div class="proof-content">
<p>Note the behaviour of <strong class="command">as.matrix</strong> on list arguments.
Write your own version of <strong class="command">simplify2array</strong>
named <strong class="command">as.matrix.list</strong> that <em>always</em>
returns a matrix. If a list of non-equisized vectors is given,
fill the missing cells with <code class="docutils literal notranslate"><span class="pre">NA</span></code>s.</p>
</div></div><div class="admonition important">
<p class="admonition-title">Important</p>
<p>Sometimes a call to <strong class="command">do.call</strong><code class="code docutils literal notranslate"><span class="pre">(</span></code><strong class="command">cbind</strong><code class="code docutils literal notranslate"><span class="pre">,</span> <span class="pre">x))</span></code>
might be a better idea than a referral to <strong class="command">simplify2array</strong>.
Provided that <code class="docutils literal notranslate"><span class="pre">x</span></code> is a list of atomic vectors,
it <em>always</em> returns a matrix: shorter vectors are recycled
(which might be welcome, but not necessarily).</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">do.call</span><span class="p">(</span><span class="n">cbind</span><span class="p">,</span> <span class="nf">list</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="n">u</span><span class="o">=</span><span class="m">1</span><span class="p">),</span> <span class="n">b</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="n">v</span><span class="o">=</span><span class="m">2</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="m">3</span><span class="p">),</span> <span class="n">c</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="m">4</span><span class="p">,</span> <span class="n">j</span><span class="o">=</span><span class="m">5</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="m">6</span><span class="p">)))</span>
<span class="c1">## Warning in (function (..., deparse.level = 1) : number of rows of result</span>
<span class="c1">## is not a multiple of vector length (arg 2)</span>
<span class="c1">##   a b c</span>
<span class="c1">## i 1 2 4</span>
<span class="c1">## j 1 3 5</span>
<span class="c1">## k 1 2 6</span>
</pre></div>
</div>
</div>
<div class="proof proof-type-example" id="id26">

    <div class="proof-title">
        <span class="proof-type">Example 11.4</span>
        
    </div><div class="proof-content">
<p>Consider a named toy list of numeric vectors:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">&lt;-</span> <span class="nf">list</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="nf">runif</span><span class="p">(</span><span class="m">10</span><span class="p">),</span> <span class="n">b</span><span class="o">=</span><span class="nf">rnorm</span><span class="p">(</span><span class="m">15</span><span class="p">))</span>
</pre></div>
</div>
<p>Compare the results generated by <strong class="command">sapply</strong>
(which calls <strong class="command">simplify2array</strong>):</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">sapply</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nf">function</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="nf">c</span><span class="p">(</span><span class="n">Mean</span><span class="o">=</span><span class="nf">mean</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>
<span class="c1">##  a.Mean  b.Mean </span>
<span class="c1">## 0.57825 0.12431</span>
<span class="nf">sapply</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nf">function</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="nf">c</span><span class="p">(</span><span class="n">Min</span><span class="o">=</span><span class="nf">min</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">Max</span><span class="o">=</span><span class="nf">max</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>
<span class="c1">##            a       b</span>
<span class="c1">## Min 0.045556 -1.9666</span>
<span class="c1">## Max 0.940467  1.7869</span>
</pre></div>
</div>
<p>with its version based on <strong class="command">do.call</strong> and <strong class="command">cbind</strong>:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">sapply2</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="kc">...</span><span class="p">)</span>
    <span class="nf">do.call</span><span class="p">(</span><span class="n">cbind</span><span class="p">,</span> <span class="nf">lapply</span><span class="p">(</span><span class="kc">...</span><span class="p">))</span>

<span class="nf">sapply2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nf">function</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="nf">c</span><span class="p">(</span><span class="n">Mean</span><span class="o">=</span><span class="nf">mean</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>
<span class="c1">##            a       b</span>
<span class="c1">## Mean 0.57825 0.12431</span>
<span class="nf">sapply2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nf">function</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="nf">c</span><span class="p">(</span><span class="n">Min</span><span class="o">=</span><span class="nf">min</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">Max</span><span class="o">=</span><span class="nf">max</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>
<span class="c1">##            a       b</span>
<span class="c1">## Min 0.045556 -1.9666</span>
<span class="c1">## Max 0.940467  1.7869</span>
</pre></div>
</div>
<p>Note that <strong class="command">sapply</strong> may return an atomic vector
with somewhat surprising <code class="docutils literal notranslate"><span class="pre">names</span></code>.</p>
</div></div></section>
<section id="beyond-numeric-arrays">
<h3><span class="section-number">11.1.4. </span>Beyond Numeric Arrays<a class="headerlink" href="#beyond-numeric-arrays" title="Permalink to this heading"></a></h3>
<p>Arrays built upon atomic vectors other than numeric ones are possible too.
For instance, later we will stress that comparisons featuring matrices
are performed elementwisely, which results in logical matrices:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">A</span> <span class="o">&gt;=</span> <span class="m">3</span>
<span class="c1">##       [,1]  [,2] [,3]</span>
<span class="c1">## [1,] FALSE FALSE TRUE</span>
<span class="c1">## [2,]  TRUE  TRUE TRUE</span>
</pre></div>
</div>
<p>Furthermore, matrices of character strings can be useful too:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">matrix</span><span class="p">(</span><span class="nf">strrep</span><span class="p">(</span><span class="kc">LETTERS</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">6</span><span class="p">],</span> <span class="m">1</span><span class="o">:</span><span class="m">6</span><span class="p">),</span> <span class="n">ncol</span><span class="o">=</span><span class="m">3</span><span class="p">)</span>
<span class="c1">##      [,1] [,2]   [,3]    </span>
<span class="c1">## [1,] &quot;A&quot;  &quot;CCC&quot;  &quot;EEEEE&quot; </span>
<span class="c1">## [2,] &quot;BB&quot; &quot;DDDD&quot; &quot;FFFFFF&quot;</span>
</pre></div>
</div>
<p>And of course complex matrices:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">A</span> <span class="o">+</span> <span class="m">1i</span>
<span class="c1">##      [,1] [,2] [,3]</span>
<span class="c1">## [1,] 1+1i 2+1i 3+1i</span>
<span class="c1">## [2,] 4+1i 5+1i 6+1i</span>
</pre></div>
</div>
<p>We are not limited to <em>atomic</em> vectors: lists can
be a basis for arrays as well:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">matrix</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">11</span><span class="o">:</span><span class="m">21</span><span class="p">,</span> <span class="s">&quot;A&quot;</span><span class="p">,</span> <span class="nf">list</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">)),</span> <span class="n">nrow</span><span class="o">=</span><span class="m">2</span><span class="p">)</span>
<span class="c1">##      [,1]       [,2]  </span>
<span class="c1">## [1,] 1          &quot;A&quot;   </span>
<span class="c1">## [2,] integer,11 list,3</span>
</pre></div>
</div>
<p>Some elements are not displayed properly, but they are still there.</p>
</section>
<section id="internal-representation">
<span id="sec-matrix-representation"></span><h3><span class="section-number">11.1.5. </span>Internal Representation<a class="headerlink" href="#internal-representation" title="Permalink to this heading"></a></h3>
<p>An object of S3 class <code class="docutils literal notranslate"><span class="pre">array</span></code> is an atomic vector or a list
equipped with the <code class="docutils literal notranslate"><span class="pre">dims</span></code> attribute, which is a vector of nonnegative integers.
Interestingly, we do not have to set the <code class="docutils literal notranslate"><span class="pre">class</span></code> attribute explicitly:
the accessor function <strong class="command">class</strong> will return an implicit<a class="footnote-reference brackets" href="#footunclass" id="id3">2</a>
class anyway (compare <a class="reference internal" href="140-list.html#sec-special-attributes"><span class="std std-numref">Section 4.4.3</span></a>).</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">class</span><span class="p">(</span><span class="m">1</span><span class="p">)</span>  <span class="c1"># atomic vector</span>
<span class="c1">## [1] &quot;numeric&quot;</span>
<span class="nf">class</span><span class="p">(</span><span class="nf">structure</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="nf">rep</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">)))</span>  <span class="c1"># 1D array (vector)</span>
<span class="c1">## [1] &quot;array&quot;</span>
<span class="nf">class</span><span class="p">(</span><span class="nf">structure</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="nf">rep</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">)))</span>  <span class="c1"># 2D array (matrix)</span>
<span class="c1">## [1] &quot;matrix&quot; &quot;array&quot;</span>
<span class="nf">class</span><span class="p">(</span><span class="nf">structure</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="nf">rep</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">3</span><span class="p">)))</span>  <span class="c1"># 3D array</span>
<span class="c1">## [1] &quot;array&quot;</span>
</pre></div>
</div>
<p>Note that a 2-dimensional array is additionally of class <code class="docutils literal notranslate"><span class="pre">matrix</span></code>.</p>
<p>Optional dimension names are represented by means of the <code class="docutils literal notranslate"><span class="pre">dimnames</span></code>
attribute, which is a list of <em>d</em> character vectors,
where <em>d</em> is the array’s dimensionality.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">A</span> <span class="o">&lt;-</span> <span class="nf">structure</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">6</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">),</span> <span class="n">dimnames</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="kc">letters</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">],</span> <span class="kc">LETTERS</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">])))</span>
<span class="c1">##   A B C</span>
<span class="c1">## a 1 3 5</span>
<span class="c1">## b 2 4 6</span>
<span class="nf">dim</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>  <span class="c1"># or attr(A, &quot;dim&quot;)</span>
<span class="c1">## [1] 2 3</span>
<span class="nf">dimnames</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>  <span class="c1"># or attr(A, &quot;dimnames&quot;)</span>
<span class="c1">## [[1]]</span>
<span class="c1">## [1] &quot;a&quot; &quot;b&quot;</span>
<span class="c1">## </span>
<span class="c1">## [[2]]</span>
<span class="c1">## [1] &quot;A&quot; &quot;B&quot; &quot;C&quot;</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Internally, elements in an array are always
stored in the columnwise (column-major, Fortran) order:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>  <span class="c1"># drop all attributes to reveal the underlying numeric vector</span>
<span class="c1">## [1] 1 2 3 4 5 6</span>
</pre></div>
</div>
<p>Setting <code class="docutils literal notranslate"><span class="pre">byrow=TRUE</span></code> in a call to the <strong class="command">matrix</strong>
only affects the order in which this function reads a given source vector,
not the column/row-majorness.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">B</span> <span class="o">&lt;-</span> <span class="nf">matrix</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">6</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="m">3</span><span class="p">,</span> <span class="n">byrow</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">))</span>
<span class="c1">##      [,1] [,2] [,3]</span>
<span class="c1">## [1,]    1    2    3</span>
<span class="c1">## [2,]    4    5    6</span>
<span class="nf">as.numeric</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>
<span class="c1">## [1] 1 4 2 5 3 6</span>
</pre></div>
</div>
</div>
<p>The two said special attributes can be modified through the replacement
functions `<strong class="command">dim&lt;-</strong>` and `<strong class="command">dimnames&lt;-</strong>`
(and of course `<strong class="command">attr&lt;-</strong>` as well).
In particular, changing <code class="docutils literal notranslate"><span class="pre">dim</span></code> does not alter the underlying atomic vector;
it only affects how other functions, including the corresponding
<strong class="command">print</strong> method, interpret their placement on a virtual grid:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">`dim&lt;-`</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="nf">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span> <span class="m">2</span><span class="p">))</span>  <span class="c1"># not the same as transpose of A</span>
<span class="c1">##      [,1] [,2]</span>
<span class="c1">## [1,]    1    4</span>
<span class="c1">## [2,]    2    5</span>
<span class="c1">## [3,]    3    6</span>
</pre></div>
</div>
<p>What we have obtained is a different <em>view</em> on the same <em>flat</em> data vector.
Also, <code class="docutils literal notranslate"><span class="pre">dimnames</span></code> were dropped because its size became
incompatible with the newly requested dimensionality.</p>
<div class="proof proof-type-exercise" id="id27">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.5</span>
        
    </div><div class="proof-content">
<p>Study the source code of the <strong class="command">nrow</strong>,
<strong class="command">NROW</strong>, <strong class="command">ncol</strong>, <strong class="command">NCOL</strong>,
<strong class="command">rownames</strong>, <strong class="command">row.names</strong>, and
<strong class="command">colnames</strong> functions.</p>
</div></div><p>Interestingly, for one-dimensional arrays, the
<strong class="command">names</strong> function returns a sensible value
(based on the <code class="docutils literal notranslate"><span class="pre">dimnames</span></code> attribute which is a list featuring one character
vector), despite the <code class="docutils literal notranslate"><span class="pre">names</span></code> attribute’s not being set.</p>
<p>What is more, <code class="docutils literal notranslate"><span class="pre">dimnames</span></code> itself can be named:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">names</span><span class="p">(</span><span class="nf">dimnames</span><span class="p">(</span><span class="n">A</span><span class="p">))</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;ROWS&quot;</span><span class="p">,</span> <span class="s">&quot;COLUMNS&quot;</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
<span class="c1">##     COLUMNS</span>
<span class="c1">## ROWS A B C</span>
<span class="c1">##    a 1 3 5</span>
<span class="c1">##    b 2 4 6</span>
</pre></div>
</div>
<p>It is still a numeric matrix, but the presentation thereof is
slightly prettified.</p>
<div class="proof proof-type-exercise" id="id28">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.6</span>
        
    </div><div class="proof-content">
<p><strong class="command">outer</strong> applies a given (vectorised elementwisely) function
on each pair of elements from two vectors, forming a two-dimensional
result grid.
Based on two calls to <strong class="command">rep</strong>, implement your own version thereof.</p>
<p>Some examples:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">outer</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="m">1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="m">10</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="m">100</span><span class="p">),</span> <span class="nf">c</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="m">1</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="m">2</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="m">3</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="m">4</span><span class="p">),</span> <span class="s">&quot;*&quot;</span><span class="p">)</span>  <span class="c1"># multiplication</span>
<span class="c1">##     a   b   c   d</span>
<span class="c1">## x   1   2   3   4</span>
<span class="c1">## y  10  20  30  40</span>
<span class="c1">## z 100 200 300 400</span>
<span class="nf">outer</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">,</span> <span class="s">&quot;B&quot;</span><span class="p">),</span> <span class="m">1</span><span class="o">:</span><span class="m">8</span><span class="p">,</span> <span class="n">paste</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;-&quot;</span><span class="p">)</span>  <span class="c1"># concatenate strings</span>
<span class="c1">##      [,1]  [,2]  [,3]  [,4]  [,5]  [,6]  [,7]  [,8] </span>
<span class="c1">## [1,] &quot;A-1&quot; &quot;A-2&quot; &quot;A-3&quot; &quot;A-4&quot; &quot;A-5&quot; &quot;A-6&quot; &quot;A-7&quot; &quot;A-8&quot;</span>
<span class="c1">## [2,] &quot;B-1&quot; &quot;B-2&quot; &quot;B-3&quot; &quot;B-4&quot; &quot;B-5&quot; &quot;B-6&quot; &quot;B-7&quot; &quot;B-8&quot;</span>
</pre></div>
</div>
</div></div><div class="proof proof-type-exercise" id="id29">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.7</span>
        
    </div><div class="proof-content">
<p>Show how <strong class="command">match</strong><code class="code docutils literal notranslate"><span class="pre">(y,</span> <span class="pre">z)</span></code> can be implemented
with <strong class="command">outer</strong>. Is its time and memory complexity
optimal, though?</p>
</div></div><div class="proof proof-type-exercise" id="id30">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.8</span>
        
    </div><div class="proof-content">
<p><strong class="command">table</strong> creates a contingency matrix/array that
counts the number of unique pairs of corresponding elements
from one or more vectors of equal lengths.
Implement its one- and two-argument version based on
<strong class="command">tabulate</strong>.</p>
<p>For example:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">tips</span> <span class="o">&lt;-</span> <span class="nf">read.csv</span><span class="p">(</span><span class="nf">paste0</span><span class="p">(</span><span class="s">&quot;https://github.com/gagolews/teaching-data/raw/&quot;</span><span class="p">,</span>
    <span class="s">&quot;master/other/tips.csv&quot;</span><span class="p">),</span> <span class="n">comment.char</span><span class="o">=</span><span class="s">&quot;#&quot;</span><span class="p">)</span>  <span class="c1"># a data.frame (list)</span>
<span class="nf">table</span><span class="p">(</span><span class="n">tips</span><span class="p">[[</span><span class="s">&quot;day&quot;</span><span class="p">]])</span>
<span class="c1">## </span>
<span class="c1">##  Fri  Sat  Sun Thur </span>
<span class="c1">##   19   87   76   62</span>
<span class="nf">table</span><span class="p">(</span><span class="n">tips</span><span class="p">[[</span><span class="s">&quot;smoker&quot;</span><span class="p">]],</span> <span class="n">tips</span><span class="p">[[</span><span class="s">&quot;day&quot;</span><span class="p">]])</span>
<span class="c1">##      </span>
<span class="c1">##       Fri Sat Sun Thur</span>
<span class="c1">##   No    4  45  57   45</span>
<span class="c1">##   Yes  15  42  19   17</span>
</pre></div>
</div>
</div></div></section>
</section>
<section id="array-indexing">
<h2><span class="section-number">11.2. </span>Array Indexing<a class="headerlink" href="#array-indexing" title="Permalink to this heading"></a></h2>
<p>Array subsetting can be performed by means of an overloaded<a class="footnote-reference brackets" href="#footsqover" id="id4">3</a>
`<strong class="command">[</strong>` method, which we will usually provide with
many indexers – two in the matrix case; see <strong class="command">help</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;[&quot;)</span></code>.</p>
<p>In this section, we will be referring to the two following
example matrices.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">A</span> <span class="o">&lt;-</span> <span class="nf">matrix</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">12</span><span class="p">,</span> <span class="n">byrow</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">nrow</span><span class="o">=</span><span class="m">3</span><span class="p">))</span>
<span class="c1">##      [,1] [,2] [,3] [,4]</span>
<span class="c1">## [1,]    1    2    3    4</span>
<span class="c1">## [2,]    5    6    7    8</span>
<span class="c1">## [3,]    9   10   11   12</span>
<span class="n">B</span> <span class="o">&lt;-</span> <span class="n">A</span>
<span class="nf">dimnames</span><span class="p">(</span><span class="n">B</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="nf">list</span><span class="p">(</span>
    <span class="nf">c</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="s">&quot;b&quot;</span><span class="p">,</span> <span class="s">&quot;c&quot;</span><span class="p">),</span>     <span class="c1"># row labels</span>
    <span class="nf">c</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">,</span> <span class="s">&quot;y&quot;</span><span class="p">,</span> <span class="s">&quot;z&quot;</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="c1"># column labels</span>
<span class="p">)</span>
<span class="n">B</span>
<span class="c1">##   x  y  z  w</span>
<span class="c1">## a 1  2  3  4</span>
<span class="c1">## b 5  6  7  8</span>
<span class="c1">## c 9 10 11 12</span>
</pre></div>
</div>
<p>Subsetting higher-dimensional arrays will be covered
at the end.</p>
<section id="arrays-are-built-upon-basic-vectors">
<h3><span class="section-number">11.2.1. </span>Arrays Are Built upon Basic Vectors<a class="headerlink" href="#arrays-are-built-upon-basic-vectors" title="Permalink to this heading"></a></h3>
<p>Firstly, let us note, though, that subsetting based on one
indexer (as in <a class="reference internal" href="150-indexing.html#chap-indexing"><span class="std std-numref">Chapter 5</span></a>)
will refer to the underlying flat vector.</p>
<p>For instance:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">A</span><span class="p">[</span><span class="m">6</span><span class="p">]</span>
<span class="c1">## [1] 10</span>
</pre></div>
</div>
<p>This is the element in the third row, second column: recall that
values are stored in a column-major order.</p>
</section>
<section id="selecting-individual-elements">
<h3><span class="section-number">11.2.2. </span>Selecting Individual Elements<a class="headerlink" href="#selecting-individual-elements" title="Permalink to this heading"></a></h3>
<p>Mathematically, we say that our example 3-by-4 real matrix
<span class="math notranslate nohighlight">\(\mathbf{A}\in\mathbb{R}^{3\times 4}\)</span> is like:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\mathbf{A}=
\left[
\begin{array}{cccc}
a_{1,1} &amp; a_{1,2} &amp; a_{1,3} &amp; a_{1,4}  \\
a_{2,1} &amp; a_{2,2} &amp; a_{2,3} &amp; a_{2,4}  \\
a_{3,1} &amp; a_{3,2} &amp; a_{3,3} &amp; a_{3,4}  \\
\end{array}
\right]
=
\left[
\begin{array}{cccc}
1 &amp; 2 &amp; 3 &amp; 4\\
5 &amp; 6 &amp; 7 &amp; 8 \\
9 &amp; 10&amp; 11&amp; 12 \\
\end{array}
\right].
\end{split}\]</div>
<p>Matrix elements are aligned in a two-dimensional grid.
They are organised into rows and columns.
Hence, we can pinpoint a cell using two indexes:
<span class="math notranslate nohighlight">\(a_{i,j}\)</span> refers to the <em>i</em>-th row and the <em>j</em>-th column.</p>
<p>Similarly in R:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">A</span><span class="p">[</span><span class="m">3</span><span class="p">,</span> <span class="m">2</span><span class="p">]</span>  <span class="c1"># 3rd row, 2nd column</span>
<span class="c1">## [1] 10</span>
<span class="n">B</span><span class="p">[</span><span class="s">&quot;c&quot;</span><span class="p">,</span> <span class="s">&quot;y&quot;</span><span class="p">]</span>  <span class="c1"># using dimnames == B[3, 2]</span>
<span class="c1">## [1] 10</span>
</pre></div>
</div>
</section>
<section id="selecting-rows-and-columns">
<h3><span class="section-number">11.2.3. </span>Selecting Rows and Columns<a class="headerlink" href="#selecting-rows-and-columns" title="Permalink to this heading"></a></h3>
<p>Some textbooks, and we are fond of this notation here as well,
mark with  <span class="math notranslate nohighlight">\(\mathbf{a}_{i,\cdot}\)</span>
a vector that consists of all the elements in
the <em>i</em>-th row and with <span class="math notranslate nohighlight">\(\mathbf{a}_{\cdot,j}\)</span> all items
in the <em>j</em>-th column.</p>
<p>In R, these will correspond to one of the indexers being left out.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">A</span><span class="p">[</span><span class="m">3</span><span class="p">,</span> <span class="p">]</span>  <span class="c1"># 3rd row</span>
<span class="c1">## [1]  9 10 11 12</span>
<span class="n">A</span><span class="p">[,</span> <span class="m">2</span><span class="p">]</span>  <span class="c1"># 2nd column</span>
<span class="c1">## [1]  2  6 10</span>
<span class="n">B</span><span class="p">[</span><span class="s">&quot;c&quot;</span><span class="p">,</span> <span class="p">]</span>  <span class="c1"># or B[3, ]</span>
<span class="c1">##  x  y  z  w </span>
<span class="c1">##  9 10 11 12</span>
<span class="n">B</span><span class="p">[,</span> <span class="s">&quot;y&quot;</span><span class="p">]</span>  <span class="c1"># or B[, 2]</span>
<span class="c1">##  a  b  c </span>
<span class="c1">##  2  6 10</span>
</pre></div>
</div>
<p>Let us stress that <code class="docutils literal notranslate"><span class="pre">A[1]</span></code>, <code class="docutils literal notranslate"><span class="pre">A[1,</span> <span class="pre">]</span></code>, and <code class="docutils literal notranslate"><span class="pre">A[,</span> <span class="pre">1]</span></code> have all different
meanings.
Also, we see that the results’ <code class="docutils literal notranslate"><span class="pre">dimnames</span></code> are adjusted accordingly;
see also <strong class="command">unname</strong> which can take care of them once and for all.</p>
<div class="proof proof-type-exercise" id="id31">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.9</span>
        
    </div><div class="proof-content">
<p>Use <strong class="command">duplicated</strong> to remove repeating rows
in a given numeric matrix (see also <strong class="command">unique</strong>).</p>
</div></div></section>
<section id="dropping-dimensions">
<h3><span class="section-number">11.2.4. </span>Dropping Dimensions<a class="headerlink" href="#dropping-dimensions" title="Permalink to this heading"></a></h3>
<p>Extracting an individual element or a single row/column from a matrix
yields an atomic vector.
If the <code class="docutils literal notranslate"><span class="pre">dim</span></code> attribute consists of 1s only, it will be removed whatsoever.</p>
<p>In order to obtain proper row and column vectors, we can request the
preservation of the
dimensionality of the output object (and, more precisely,
the length of <code class="docutils literal notranslate"><span class="pre">dim</span></code>) by passing <code class="docutils literal notranslate"><span class="pre">drop=FALSE</span></code>
to `<strong class="command">[</strong>`.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">A</span><span class="p">[</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">]</span>  <span class="c1"># 1st row, 2nd columns</span>
<span class="c1">##      [,1]</span>
<span class="c1">## [1,]    2</span>
<span class="n">A</span><span class="p">[</span><span class="m">1</span><span class="p">,</span>  <span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">]</span>  <span class="c1"># 1st row</span>
<span class="c1">##      [,1] [,2] [,3] [,4]</span>
<span class="c1">## [1,]    1    2    3    4</span>
<span class="n">A</span><span class="p">[</span> <span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">]</span>  <span class="c1"># 2nd column</span>
<span class="c1">##      [,1]</span>
<span class="c1">## [1,]    2</span>
<span class="c1">## [2,]    6</span>
<span class="c1">## [3,]   10</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The <code class="docutils literal notranslate"><span class="pre">drop</span></code> argument unfortunately defaults to <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>. Many bugs could be
avoided more easily otherwise, especially when the indexers
are generated programmatically.</p>
</div>
<p>See also the <strong class="command">drop</strong> function which gets rid of the dimensions
that have only one level.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For list-based matrices, we can also use a multi-argument
version of `<strong class="command">[[</strong>` to extract the individual elements.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">C</span> <span class="o">&lt;-</span> <span class="nf">matrix</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">11</span><span class="o">:</span><span class="m">12</span><span class="p">,</span> <span class="m">21</span><span class="o">:</span><span class="m">23</span><span class="p">,</span> <span class="m">31</span><span class="o">:</span><span class="m">34</span><span class="p">),</span> <span class="n">nrow</span><span class="o">=</span><span class="m">2</span><span class="p">)</span>
<span class="n">C</span><span class="p">[</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">]</span>  <span class="c1"># for `[`, input type is the same as the output type, hence a list</span>
<span class="c1">## [[1]]</span>
<span class="c1">## [1] 21 22 23</span>
<span class="n">C</span><span class="p">[</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">]</span>
<span class="c1">##      [,1]     </span>
<span class="c1">## [1,] integer,3</span>
<span class="n">C</span><span class="p">[[</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">]]</span>  <span class="c1"># extract</span>
<span class="c1">## [1] 21 22 23</span>
</pre></div>
</div>
</div>
</section>
<section id="selecting-submatrices">
<h3><span class="section-number">11.2.5. </span>Selecting Submatrices<a class="headerlink" href="#selecting-submatrices" title="Permalink to this heading"></a></h3>
<p>Indexing based on two vectors, both of length two or more, extracts
a sub-block of a given matrix:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">A</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">,</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">4</span><span class="p">)]</span>  <span class="c1"># rows 1,2 columns 1,2,4</span>
<span class="c1">##      [,1] [,2] [,3]</span>
<span class="c1">## [1,]    1    2    4</span>
<span class="c1">## [2,]    5    6    8</span>
<span class="n">B</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="s">&quot;b&quot;</span><span class="p">),</span> <span class="m">-3</span><span class="p">]</span>
<span class="c1">##   x y w</span>
<span class="c1">## a 1 2 4</span>
<span class="c1">## b 5 6 8</span>
</pre></div>
</div>
<p>Note again that <code class="docutils literal notranslate"><span class="pre">drop=TRUE</span></code> is the default,
which affects the behaviour if one of the indexers is a scalar.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">A</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">3</span><span class="p">),</span> <span class="m">3</span><span class="p">]</span>
<span class="c1">## [1]  3 11</span>
<span class="n">A</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">3</span><span class="p">),</span> <span class="m">3</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">]</span>
<span class="c1">##      [,1]</span>
<span class="c1">## [1,]    3</span>
<span class="c1">## [2,]   11</span>
</pre></div>
</div>
<div class="proof proof-type-exercise" id="id32">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.10</span>
        
    </div><div class="proof-content">
<p>Overload the <strong class="command">split</strong> function for the <code class="docutils literal notranslate"><span class="pre">matrix</span></code> class
in such a way that, given a matrix with <em>n</em> rows and an
object of class <code class="docutils literal notranslate"><span class="pre">factor</span></code> of length <em>n</em> (or a list of such objects),
a list of <em>n</em> matrices is returned. For example:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">split.matrix</span> <span class="o">&lt;-</span> <span class="n">...to.do...</span>
<span class="n">A</span> <span class="o">&lt;-</span> <span class="nf">matrix</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">12</span><span class="p">,</span> <span class="n">nrow</span><span class="o">=</span><span class="m">3</span><span class="p">)</span>  <span class="c1"># matrix whose rows are to be split</span>
<span class="n">s</span> <span class="o">&lt;-</span> <span class="nf">factor</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="s">&quot;b&quot;</span><span class="p">,</span> <span class="s">&quot;a&quot;</span><span class="p">))</span>  <span class="c1"># determines the grouping of rows</span>
<span class="nf">split</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
<span class="c1">## $a</span>
<span class="c1">##      [,1] [,2] [,3] [,4]</span>
<span class="c1">## [1,]    1    4    7   10</span>
<span class="c1">## [2,]    3    6    9   12</span>
<span class="c1">## </span>
<span class="c1">## $b</span>
<span class="c1">##      [,1] [,2] [,3] [,4]</span>
<span class="c1">## [1,]    2    5    8   11</span>
</pre></div>
</div>
</div></div></section>
<section id="selecting-elements-based-on-logical-vectors">
<h3><span class="section-number">11.2.6. </span>Selecting Elements Based on Logical Vectors<a class="headerlink" href="#selecting-elements-based-on-logical-vectors" title="Permalink to this heading"></a></h3>
<p>Logical vectors can also be used as indexers, with consequences
that are not hard to guess:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">A</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="kc">TRUE</span><span class="p">,</span> <span class="kc">FALSE</span><span class="p">,</span> <span class="kc">TRUE</span><span class="p">),</span> <span class="m">-1</span><span class="p">]</span>  <span class="c1"># select 1st and 3rd row, all but 1st column</span>
<span class="c1">##      [,1] [,2] [,3]</span>
<span class="c1">## [1,]    4    7   10</span>
<span class="c1">## [2,]    6    9   12</span>
<span class="n">B</span><span class="p">[</span><span class="n">B</span><span class="p">[,</span> <span class="s">&quot;x&quot;</span><span class="p">]</span><span class="o">&gt;</span><span class="m">1</span> <span class="o">&amp;</span> <span class="n">B</span><span class="p">[,</span> <span class="s">&quot;x&quot;</span><span class="p">]</span><span class="o">&lt;=</span><span class="m">9</span><span class="p">,</span> <span class="p">]</span>  <span class="c1"># all rows where x is in (1, 9]</span>
<span class="c1">##   x  y  z  w</span>
<span class="c1">## b 5  6  7  8</span>
<span class="c1">## c 9 10 11 12</span>
<span class="n">A</span><span class="p">[</span><span class="m">2</span><span class="p">,</span> <span class="nf">colMeans</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="o">&gt;</span><span class="m">6</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">]</span>  <span class="c1"># 2nd row of the columns with means &gt; 6</span>
<span class="c1">##      [,1] [,2]</span>
<span class="c1">## [1,]    8   11</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In <a class="reference internal" href="#sec-matrix-op"><span class="std std-numref">Section 11.3</span></a>, we note that comparisons involving matrices
are performed in an elementwise manner, for example:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">A</span><span class="o">&gt;</span><span class="m">7</span>
<span class="c1">##       [,1]  [,2]  [,3] [,4]</span>
<span class="c1">## [1,] FALSE FALSE FALSE TRUE</span>
<span class="c1">## [2,] FALSE FALSE  TRUE TRUE</span>
<span class="c1">## [3,] FALSE FALSE  TRUE TRUE</span>
</pre></div>
</div>
<p>Such logical matrices can be used to index other matrices of the
same size. This always yields a (flat) vector in return.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">A</span><span class="p">[</span><span class="n">A</span><span class="o">&gt;</span><span class="m">7</span><span class="p">]</span>
<span class="c1">## [1]  8  9 10 11 12</span>
</pre></div>
</div>
<p>This nothing else than the single-indexer subsetting
involving two flat vectors (a numeric and a logical one);
the <code class="docutils literal notranslate"><span class="pre">dim</span></code> attributes are not considered here.</p>
</div>
<div class="proof proof-type-exercise" id="id33">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.11</span>
        
    </div><div class="proof-content">
<p>Implement your own versions of <strong class="command">max.col</strong>,
<strong class="command">lower.tri</strong>, and <strong class="command">upper.tri</strong>.</p>
</div></div></section>
<section id="selecting-based-on-two-column-numeric-matrices">
<h3><span class="section-number">11.2.7. </span>Selecting Based on Two-Column Numeric Matrices<a class="headerlink" href="#selecting-based-on-two-column-numeric-matrices" title="Permalink to this heading"></a></h3>
<p>We can also index a matrix <code class="docutils literal notranslate"><span class="pre">A</span></code>
with a two-column matrix of positive integers <code class="docutils literal notranslate"><span class="pre">I</span></code>, for instance:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">I</span> <span class="o">&lt;-</span> <span class="nf">cbind</span><span class="p">(</span>
    <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">),</span>
    <span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">4</span><span class="p">)</span>
<span class="p">))</span>
<span class="c1">##      [,1] [,2]</span>
<span class="c1">## [1,]    1    2</span>
<span class="c1">## [2,]    3    3</span>
<span class="c1">## [3,]    2    2</span>
<span class="c1">## [4,]    1    1</span>
<span class="c1">## [5,]    2    4</span>
</pre></div>
</div>
<p>Now <code class="docutils literal notranslate"><span class="pre">A[I]</span></code> gives an easy access to:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">A[I[1,</span> <span class="pre">1],</span> <span class="pre">I[1,</span> <span class="pre">2]]</span></code>,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">A[I[2,</span> <span class="pre">1],</span> <span class="pre">I[2,</span> <span class="pre">2]]</span></code>,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">A[I[3,</span> <span class="pre">1],</span> <span class="pre">I[3,</span> <span class="pre">2]]</span></code>,</p></li>
<li><p>…</p></li>
</ul>
<p>and so forth. In other words, each row of <code class="docutils literal notranslate"><span class="pre">I</span></code> gives
the coordinates of the elements to extract.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">A</span><span class="p">[</span><span class="n">I</span><span class="p">]</span>
<span class="c1">## [1]  4  9  5  1 11</span>
</pre></div>
</div>
<p>This is exactly
<code class="docutils literal notranslate"><span class="pre">A[1,</span> <span class="pre">2],</span> <span class="pre">A[3,</span> <span class="pre">3],</span> <span class="pre">A[2,</span> <span class="pre">2],</span> <span class="pre">A[1,</span> <span class="pre">1],</span> <span class="pre">A[2,</span> <span class="pre">4]</span></code>.
The result is always a flat vector.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong class="command">which</strong> can also return a list of index matrices:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">which</span><span class="p">(</span><span class="n">A</span><span class="o">&gt;</span><span class="m">7</span><span class="p">,</span> <span class="n">arr.ind</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
<span class="c1">##      row col</span>
<span class="c1">## [1,]   2   3</span>
<span class="c1">## [2,]   3   3</span>
<span class="c1">## [3,]   1   4</span>
<span class="c1">## [4,]   2   4</span>
<span class="c1">## [5,]   3   4</span>
</pre></div>
</div>
<p>Moreover, <strong class="command">arrayInd</strong> can be used to convert
flat indexes to multidimensional ones.</p>
</div>
<div class="proof proof-type-exercise" id="id34">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.12</span>
        
    </div><div class="proof-content">
<p>Implement your own version of <strong class="command">arrayInd</strong>
and a function performing the inverse operation.</p>
</div></div><div class="proof proof-type-exercise" id="id35">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.13</span>
        
    </div><div class="proof-content">
<p>Implement your own version of <strong class="command">diag</strong>.</p>
</div></div></section>
<section id="higher-dimensional-arrays">
<h3><span class="section-number">11.2.8. </span>Higher-Dimensional Arrays<a class="headerlink" href="#higher-dimensional-arrays" title="Permalink to this heading"></a></h3>
<p>For <em>d</em>-dimensional arrays, indexing can involve up to <em>d</em> indexes.</p>
<p>This is particularly useful for dim-named arrays that represent
contingency tables over a Cartesian product of multiple factors.
The built-in <strong class="program">datasets</strong><code class="code docutils literal notranslate"><span class="pre">::Titanic</span></code> object is
an example of this:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">str</span><span class="p">(</span><span class="nf">dimnames</span><span class="p">(</span><span class="n">Titanic</span><span class="p">))</span>  <span class="c1"># for reference (note that dimnames are named)</span>
<span class="c1">## List of 4</span>
<span class="c1">##  $ Class   : chr [1:4] &quot;1st&quot; &quot;2nd&quot; &quot;3rd&quot; &quot;Crew&quot;</span>
<span class="c1">##  $ Sex     : chr [1:2] &quot;Male&quot; &quot;Female&quot;</span>
<span class="c1">##  $ Age     : chr [1:2] &quot;Child&quot; &quot;Adult&quot;</span>
<span class="c1">##  $ Survived: chr [1:2] &quot;No&quot; &quot;Yes&quot;</span>
<span class="n">Titanic</span><span class="p">[</span><span class="s">&quot;Crew&quot;</span><span class="p">,</span> <span class="s">&quot;Male&quot;</span><span class="p">,</span> <span class="s">&quot;Adult&quot;</span><span class="p">,</span> <span class="s">&quot;Yes&quot;</span><span class="p">]</span>
<span class="c1">## [1] 192</span>
</pre></div>
</div>
<p>gives the number of adult male members of the crew who survived
the accident. Also:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">Titanic</span><span class="p">[</span><span class="s">&quot;Crew&quot;</span><span class="p">,</span> <span class="p">,</span> <span class="s">&quot;Adult&quot;</span><span class="p">,</span> <span class="p">]</span>
<span class="c1">##         Survived</span>
<span class="c1">## Sex       No Yes</span>
<span class="c1">##   Male   670 192</span>
<span class="c1">##   Female   3  20</span>
</pre></div>
</div>
<p>and so on.</p>
<div class="proof proof-type-exercise" id="id36">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.14</span>
        
    </div><div class="proof-content">
<p>Check if the above four-dimensional array can be indexed by means of
matrices with four columns.</p>
</div></div></section>
<section id="replacing-elements">
<h3><span class="section-number">11.2.9. </span>Replacing Elements<a class="headerlink" href="#replacing-elements" title="Permalink to this heading"></a></h3>
<p>There is of course also a multidimensional version of the
replacement subsetting function, `<strong class="command">[&lt;-</strong>`.</p>
<p>Generally, subsetting  drops all attributes except
<code class="docutils literal notranslate"><span class="pre">names</span></code>, <code class="docutils literal notranslate"><span class="pre">dim</span></code>, and <code class="docutils literal notranslate"><span class="pre">dimnames</span></code> (unless it does not make sense otherwise).
The replacement variant of the index operator
modifies vector values but generally preserves all the attributes.</p>
<p>This enables transforming matrix elements like:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">B</span><span class="p">[</span><span class="n">B</span><span class="o">&lt;</span><span class="m">10</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="n">A</span><span class="p">[</span><span class="n">B</span><span class="o">&lt;</span><span class="m">10</span><span class="p">]</span><span class="o">^</span><span class="m">2</span>
<span class="nf">print</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>
<span class="c1">##   x  y  z   w</span>
<span class="c1">## a 1 16 49 100</span>
<span class="c1">## b 4 25 64 121</span>
<span class="c1">## c 9 10 11  12</span>
<span class="n">B</span><span class="p">[]</span> <span class="o">&lt;-</span> <span class="nf">rep</span><span class="p">(</span><span class="nf">seq_len</span><span class="p">(</span><span class="nf">NROW</span><span class="p">(</span><span class="n">B</span><span class="p">)),</span> <span class="nf">NCOL</span><span class="p">(</span><span class="n">B</span><span class="p">))</span>  <span class="c1"># NOT the same as B &lt;- ...</span>
<span class="nf">print</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>
<span class="c1">##   x y z w</span>
<span class="c1">## a 1 1 1 1</span>
<span class="c1">## b 2 2 2 2</span>
<span class="c1">## c 3 3 3 3</span>
</pre></div>
</div>
<p>Take note of the preservation of <code class="docutils literal notranslate"><span class="pre">dim</span></code> and <code class="docutils literal notranslate"><span class="pre">dimnames</span></code>.</p>
<div class="proof proof-type-exercise" id="id37">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.15</span>
        
    </div><div class="proof-content">
<p>Given a character matrix with entities that can be interpreted
as numbers like:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">X</span> <span class="o">&lt;-</span> <span class="nf">rbind</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="s">&quot;1&quot;</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="s">&quot;2&quot;</span><span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;3&quot;</span><span class="p">,</span> <span class="s">&quot;4&quot;</span><span class="p">)))</span>
<span class="c1">##   a   b  </span>
<span class="c1">## x &quot;1&quot; &quot;2&quot;</span>
<span class="c1">## y &quot;3&quot; &quot;4&quot;</span>
</pre></div>
</div>
<p>convert it to a numeric matrix with a single line of code.</p>
</div></div></section>
</section>
<section id="common-operations">
<span id="sec-matrix-op"></span><h2><span class="section-number">11.3. </span>Common Operations<a class="headerlink" href="#common-operations" title="Permalink to this heading"></a></h2>
<section id="matrix-transpose">
<h3><span class="section-number">11.3.1. </span>Matrix Transpose<a class="headerlink" href="#matrix-transpose" title="Permalink to this heading"></a></h3>
<p>The matrix <em>transpose</em>, mathematically denoted with <span class="math notranslate nohighlight">\(\mathbf{A}^T\)</span>,
is available via a call to <strong class="command">t</strong>:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">A</span> <span class="o">&lt;-</span> <span class="nf">matrix</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">6</span><span class="p">,</span> <span class="n">byrow</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">nrow</span><span class="o">=</span><span class="m">2</span><span class="p">))</span>
<span class="c1">##      [,1] [,2] [,3]</span>
<span class="c1">## [1,]    1    2    3</span>
<span class="c1">## [2,]    4    5    6</span>
<span class="nf">t</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
<span class="c1">##      [,1] [,2]</span>
<span class="c1">## [1,]    1    4</span>
<span class="c1">## [2,]    2    5</span>
<span class="c1">## [3,]    3    6</span>
</pre></div>
</div>
<p>Hence, if <span class="math notranslate nohighlight">\(\mathbf{B}=\mathbf{A}^T\)</span>, then it is a matrix such that
<span class="math notranslate nohighlight">\(b_{i,j}=a_{j,i}\)</span>.
In other words, in the transposed matrix, rows become columns and
columns become rows.</p>
<p>For higher-dimensional arrays,
a generalised transpose can be achieved with <strong class="command">aperm</strong>
(try permuting the dimensions of <code class="docutils literal notranslate"><span class="pre">Titanic</span></code>).
Also note that the conjugate transpose of a complex matrix <span class="math notranslate nohighlight">\(\mathbf{A}\)</span>
is done via <strong class="command">Conj</strong><code class="code docutils literal notranslate"><span class="pre">(</span></code><strong class="command">t</strong><code class="code docutils literal notranslate"><span class="pre">(A))</span></code>.</p>
</section>
<section id="vectorised-mathematical-functions">
<h3><span class="section-number">11.3.2. </span>Vectorised Mathematical Functions<a class="headerlink" href="#vectorised-mathematical-functions" title="Permalink to this heading"></a></h3>
<p>Vectorised functions such as
<strong class="command">sqrt</strong>,
<strong class="command">abs</strong>,
<strong class="command">round</strong>,
<strong class="command">log</strong>,
<strong class="command">exp</strong>,
<strong class="command">cos</strong>,
<strong class="command">sin</strong>,
etc.,
operate on each element of a given
array<a class="footnote-reference brackets" href="#footunarymatrix" id="id5">4</a>.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">A</span> <span class="o">&lt;-</span> <span class="nf">matrix</span><span class="p">(</span><span class="m">1</span><span class="o">/</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">6</span><span class="p">),</span> <span class="n">nrow</span><span class="o">=</span><span class="m">2</span><span class="p">)</span>
<span class="nf">round</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="m">2</span><span class="p">)</span>  <span class="c1"># rounds every element in A</span>
<span class="c1">##      [,1] [,2] [,3]</span>
<span class="c1">## [1,]  1.0 0.33 0.20</span>
<span class="c1">## [2,]  0.5 0.25 0.17</span>
</pre></div>
</div>
<div class="proof proof-type-exercise" id="id38">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.16</span>
        
    </div><div class="proof-content">
<p>Using a single call to <strong class="command">matplot</strong>, which accepts
the <code class="docutils literal notranslate"><span class="pre">y</span></code> argument be a matrix, draw a plot
of <span class="math notranslate nohighlight">\(\sin(x)\)</span>, <span class="math notranslate nohighlight">\(\cos(x)\)</span>, <span class="math notranslate nohighlight">\(|\sin(x)|\)</span>, and <span class="math notranslate nohighlight">\(|\cos(x)|\)</span>
for <span class="math notranslate nohighlight">\(x\in[-2\pi, 6\pi]\)</span>.</p>
</div></div></section>
<section id="aggregating-rows-and-columns">
<h3><span class="section-number">11.3.3. </span>Aggregating Rows and Columns<a class="headerlink" href="#aggregating-rows-and-columns" title="Permalink to this heading"></a></h3>
<p>When we call an aggregation function on an array,
it will reduce all elements to a single number:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">A</span> <span class="o">&lt;-</span> <span class="nf">matrix</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">12</span><span class="p">,</span> <span class="n">byrow</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">nrow</span><span class="o">=</span><span class="m">3</span><span class="p">))</span>
<span class="c1">##      [,1] [,2] [,3] [,4]</span>
<span class="c1">## [1,]    1    2    3    4</span>
<span class="c1">## [2,]    5    6    7    8</span>
<span class="c1">## [3,]    9   10   11   12</span>
<span class="nf">mean</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
<span class="c1">## [1] 6.5</span>
</pre></div>
</div>
<p>The <strong class="command">apply</strong> function may be used to summarise
individual rows or columns in a matrix:</p>
<ul class="simple">
<li><p><strong class="command">apply</strong><code class="code docutils literal notranslate"><span class="pre">(A,</span> <span class="pre">1,</span> <span class="pre">f)</span></code>
applies a given function <strong class="command">f</strong> on each <em>row</em> of a matrix <code class="docutils literal notranslate"><span class="pre">A</span></code>;</p></li>
<li><p><strong class="command">apply</strong><code class="code docutils literal notranslate"><span class="pre">(A,</span> <span class="pre">2,</span> <span class="pre">f)</span></code>
applies <strong class="command">f</strong> on each <em>column</em> of <code class="docutils literal notranslate"><span class="pre">A</span></code>.</p></li>
</ul>
<p>For instance:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">apply</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="n">mean</span><span class="p">)</span>  <span class="c1"># synonym: rowMeans(A)</span>
<span class="c1">## [1]  2.5  6.5 10.5</span>
<span class="nf">apply</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="n">mean</span><span class="p">)</span>  <span class="c1"># synonym: colMeans(A)</span>
<span class="c1">## [1] 5 6 7 8</span>
</pre></div>
</div>
<p>Note that the function being applied does not have to return a single number:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">apply</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="n">range</span><span class="p">)</span>  <span class="c1"># min and max</span>
<span class="c1">##      [,1] [,2] [,3] [,4]</span>
<span class="c1">## [1,]    1    2    3    4</span>
<span class="c1">## [2,]    9   10   11   12</span>
<span class="nf">apply</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="nf">function</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="nf">c</span><span class="p">(</span><span class="n">Min</span><span class="o">=</span><span class="nf">min</span><span class="p">(</span><span class="n">row</span><span class="p">),</span> <span class="n">Mean</span><span class="o">=</span><span class="nf">mean</span><span class="p">(</span><span class="n">row</span><span class="p">),</span> <span class="n">Max</span><span class="o">=</span><span class="nf">max</span><span class="p">(</span><span class="n">row</span><span class="p">)))</span>
<span class="c1">##      [,1] [,2] [,3]</span>
<span class="c1">## Min   1.0  5.0  9.0</span>
<span class="c1">## Mean  2.5  6.5 10.5</span>
<span class="c1">## Max   4.0  8.0 12.0</span>
</pre></div>
</div>
<p>Take note of the columnwise order of the output values.</p>
<p><strong class="command">apply</strong> works on higher-dimensional arrays too:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">apply</span><span class="p">(</span><span class="n">Titanic</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="n">mean</span><span class="p">)</span>  <span class="c1"># 1st dimension - Class</span>
<span class="c1">##     1st     2nd     3rd    Crew </span>
<span class="c1">##  40.625  35.625  88.250 110.625</span>
<span class="nf">apply</span><span class="p">(</span><span class="n">Titanic</span><span class="p">,</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">3</span><span class="p">),</span> <span class="n">mean</span><span class="p">)</span>  <span class="c1"># w.r.t. Class (1st) and Age (3rd)</span>
<span class="c1">##       Age</span>
<span class="c1">## Class  Child  Adult</span>
<span class="c1">##   1st   1.50  79.75</span>
<span class="c1">##   2nd   6.00  65.25</span>
<span class="c1">##   3rd  19.75 156.75</span>
<span class="c1">##   Crew  0.00 221.25</span>
</pre></div>
</div>
</section>
<section id="binary-operators">
<span id="sec-recycling-rule-revisited"></span><h3><span class="section-number">11.3.4. </span>Binary Operators<a class="headerlink" href="#binary-operators" title="Permalink to this heading"></a></h3>
<p>In <a class="reference internal" href="150-indexing.html#sec-attrpreserv"><span class="std std-numref">Section 5.5</span></a>, we have stated that
binary elementwise operations, such as addition or multiplication,
preserve the attributes of the longer input or both (with the first argument preferred to the second) if they are of equal sizes.</p>
<p>Taking into account that:</p>
<ul class="simple">
<li><p>an array is simply a flat vector equipped with the <code class="docutils literal notranslate"><span class="pre">dim</span></code> attribute, and</p></li>
<li><p>we refer to the respective <em>default</em> methods when applying binary operators</p></li>
</ul>
<p>allows us to deduce how `<strong class="command">+</strong>`,
`<strong class="command">&lt;=</strong>`, `<strong class="command">&amp;</strong>`, etc. behave in a number
of different contexts.</p>
<div style="margin-top: 1em"></div><p><strong>Array-Array.</strong>
First, let us note what happens when we operate on two arrays
of identical dimensionalities.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">A</span> <span class="o">&lt;-</span> <span class="nf">rbind</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">10</span><span class="p">,</span> <span class="m">100</span><span class="p">),</span> <span class="nf">c</span><span class="p">(</span><span class="m">-1</span><span class="p">,</span> <span class="m">-10</span><span class="p">,</span> <span class="m">-100</span><span class="p">)))</span>
<span class="c1">##      [,1] [,2] [,3]</span>
<span class="c1">## [1,]    1   10  100</span>
<span class="c1">## [2,]   -1  -10 -100</span>
<span class="p">(</span><span class="n">B</span> <span class="o">&lt;-</span> <span class="nf">matrix</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">6</span><span class="p">,</span> <span class="n">byrow</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">nrow</span><span class="o">=</span><span class="m">2</span><span class="p">))</span>
<span class="c1">##      [,1] [,2] [,3]</span>
<span class="c1">## [1,]    1    2    3</span>
<span class="c1">## [2,]    4    5    6</span>
<span class="n">A</span> <span class="o">+</span> <span class="n">B</span>  <span class="c1"># elementwise addition</span>
<span class="c1">##      [,1] [,2] [,3]</span>
<span class="c1">## [1,]    2   12  103</span>
<span class="c1">## [2,]    3   -5  -94</span>
<span class="n">A</span> <span class="o">*</span> <span class="n">B</span>  <span class="c1"># elementwise multiplication (not: algebraic matrix multiply)</span>
<span class="c1">##      [,1] [,2] [,3]</span>
<span class="c1">## [1,]    1   20  300</span>
<span class="c1">## [2,]   -4  -50 -600</span>
</pre></div>
</div>
<p>This is simply the addition and multiplication of the corresponding elements
of two given matrices.</p>
<div style="margin-top: 1em"></div><p><strong>Array-Scalar</strong>.
Second, we can apply scalar-matrix operations:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">-1</span><span class="p">)</span><span class="o">*</span><span class="n">B</span>
<span class="c1">##      [,1] [,2] [,3]</span>
<span class="c1">## [1,]   -1   -2   -3</span>
<span class="c1">## [2,]   -4   -5   -6</span>
<span class="n">A</span><span class="o">^</span><span class="m">2</span>
<span class="c1">##      [,1] [,2]  [,3]</span>
<span class="c1">## [1,]    1  100 10000</span>
<span class="c1">## [2,]    1  100 10000</span>
</pre></div>
</div>
<p>These multiplied each element in <code class="docutils literal notranslate"><span class="pre">B</span></code> by -1
and squared every element in <code class="docutils literal notranslate"><span class="pre">A</span></code>, respectively.</p>
<p>Also note that the behaviour of comparison operators is similar:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">A</span> <span class="o">&gt;=</span> <span class="m">1</span> <span class="o">&amp;</span> <span class="n">A</span> <span class="o">&lt;=</span> <span class="m">100</span>
<span class="c1">##       [,1]  [,2]  [,3]</span>
<span class="c1">## [1,]  TRUE  TRUE  TRUE</span>
<span class="c1">## [2,] FALSE FALSE FALSE</span>
</pre></div>
</div>
<div style="margin-top: 1em"></div><p><strong>Array-Vector</strong>.
Next, based on the recycling rule and the fact that
elements are ordered columnwisely, we get that:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">B</span> <span class="o">*</span> <span class="nf">c</span><span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="m">100</span><span class="p">)</span>
<span class="c1">##      [,1] [,2] [,3]</span>
<span class="c1">## [1,]   10   20   30</span>
<span class="c1">## [2,]  400  500  600</span>
</pre></div>
</div>
<p>multiplied every element in the first <em>row</em> by 10 and
each element in the second row by 100.</p>
<p>Note that if wish to multiply each element in the first, second, …, etc.
<em>column</em> by the first, second, …, etc. value in a vector,
we should <em>not</em> call:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">B</span> <span class="o">*</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">100</span><span class="p">,</span> <span class="m">1000</span><span class="p">)</span>
<span class="c1">##      [,1] [,2] [,3]</span>
<span class="c1">## [1,]    1 2000  300</span>
<span class="c1">## [2,]  400    5 6000</span>
</pre></div>
</div>
<p>but rather:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">t</span><span class="p">(</span><span class="nf">t</span><span class="p">(</span><span class="n">B</span><span class="p">)</span> <span class="o">*</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">100</span><span class="p">,</span> <span class="m">1000</span><span class="p">))</span>
<span class="c1">##      [,1] [,2] [,3]</span>
<span class="c1">## [1,]    1  200 3000</span>
<span class="c1">## [2,]    4  500 6000</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">t</span><span class="p">(</span><span class="nf">apply</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="n">`*`</span><span class="p">,</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">100</span><span class="p">,</span> <span class="m">1000</span><span class="p">)))</span>
<span class="c1">##      [,1] [,2] [,3]</span>
<span class="c1">## [1,]    1  200 3000</span>
<span class="c1">## [2,]    4  500 6000</span>
</pre></div>
</div>
<div class="proof proof-type-exercise" id="id39">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.17</span>
        
    </div><div class="proof-content">
<p>Write a function which standardises the values in each column of
a given matrix: for each column, from every element,
subtract the mean and then divide it by the standard deviation.
Try to do it in a few different ways,
including via a call to <strong class="command">apply</strong>,
<strong class="command">sweep</strong>, <strong class="command">scale</strong>, or based solely
on arithmetic operators.</p>
</div></div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>Some sanity checks are being done
on the <code class="docutils literal notranslate"><span class="pre">dim</span></code> attributes, so not every configuration is possible.
Notice the following peculiarities:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">getOption</span><span class="p">(</span><span class="s">&quot;error&quot;</span><span class="p">)</span>
<span class="c1">## NULL</span>
<span class="n">A</span> <span class="o">+</span> <span class="nf">t</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>  <span class="c1"># dim==c(2, 3) vs dim==c(3, 2)</span>
<span class="c1">## Error in A + t(B): non-conformable arrays</span>
<span class="n">A</span> <span class="o">*</span> <span class="nf">cbind</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">10</span><span class="p">,</span> <span class="m">100</span><span class="p">)</span>  <span class="c1"># this is too good to be true</span>
<span class="c1">## Error in A * cbind(1, 10, 100): non-conformable arrays</span>
<span class="n">A</span> <span class="o">*</span> <span class="nf">rbind</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">10</span><span class="p">)</span>  <span class="c1"># but A * c(1, 10) works...</span>
<span class="c1">## Error in A * rbind(1, 10): non-conformable arrays</span>
<span class="n">A</span> <span class="o">+</span> <span class="m">1</span><span class="o">:</span><span class="m">12</span>
<span class="c1">## Error in eval(expr, envir, enclos): dims [product 6] do not match the length of object [12]</span>
<span class="n">A</span> <span class="o">+</span> <span class="m">1</span><span class="o">:</span><span class="m">5</span>  <span class="c1"># partial recycling is okay</span>
<span class="c1">## Warning in A + 1:5: longer object length is not a multiple of shorter</span>
<span class="c1">## object length</span>
<span class="c1">##      [,1] [,2] [,3]</span>
<span class="c1">## [1,]    2   13  105</span>
<span class="c1">## [2,]    1   -6  -99</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="numerical-matrix-algebra">
<h2><span class="section-number">11.4. </span>Numerical Matrix Algebra (*)<a class="headerlink" href="#numerical-matrix-algebra" title="Permalink to this heading"></a></h2>
<p>Many data analysis and machine learning algorithms, in their essence,
involve quite simple matrix algebra and numerical mathematics.
Suffice to say that anyone serious about data science and scientific
computing should learn the necessary theory;
see, for example, <span id="id6">[<a class="reference internal" href="999-bibliography.html#id37" title="Gentle, J.E. (2007).  Matrix Algebra. Springer.">25</a>]</span> and <span id="id7">[<a class="reference internal" href="999-bibliography.html#id36" title="Gentle, J.E. (2009).  Computational Statistics. Springer.">26</a>]</span>.</p>
<p>R is a convenient interface to the well-tested and stable
algorithms from, amongst others, <strong class="program">LAPACK</strong> and
<strong class="program">BLAS</strong><a class="footnote-reference brackets" href="#footblas" id="id8">5</a>. Below we mention only a few of them.
Note that there are many third-party packages featuring hundreds of
algorithms tackling differential equations, constrained
and unconstrained optimisation, etc.; exploring the relevant
<a class="reference external" href="https://cran.r-project.org/web/views/">CRAN Task Views</a>
can give a good overview.</p>
<section id="matrix-multiplication">
<h3><span class="section-number">11.4.1. </span>Matrix Multiplication<a class="headerlink" href="#matrix-multiplication" title="Permalink to this heading"></a></h3>
<p>`<strong class="command">*</strong>` performs elementwise multiplication.
For what we call (algebraic) matrix multiplication,
we should use the `<strong class="command">%*%</strong>` operator.</p>
<p>Refreshing from a basic linear algebra course,
matrix multiplication can only be performed on two matrices of
<em>compatible sizes</em>: the number of columns in the left matrix must match
the number of rows in the right operand.</p>
<p>Given <span class="math notranslate nohighlight">\(\mathbf{A}\in\mathbb{R}^{n\times p}\)</span>
and <span class="math notranslate nohighlight">\(\mathbf{B}\in\mathbb{R}^{p\times m}\)</span>, their multiply is a matrix
<span class="math notranslate nohighlight">\(\mathbf{C}=\mathbf{A}\mathbf{B}\in\mathbb{R}^{n\times m}\)</span>
such that <span class="math notranslate nohighlight">\(c_{i,j}\)</span> is the dot product of the <em>i</em>-th row in <span class="math notranslate nohighlight">\(\mathbf{A}\)</span>
and the <em>j</em>-th column in <span class="math notranslate nohighlight">\(\mathbf{B}\)</span>:</p>
<div class="math notranslate nohighlight">
\[
c_{i,j} = \mathbf{a}_{i,\cdot} \cdot \mathbf{b}_{\cdot,j}
= \sum_{k=1}^p a_{i,k} b_{k, j},
\]</div>
<p>for <span class="math notranslate nohighlight">\(i=1,\dots,n\)</span> and <span class="math notranslate nohighlight">\(j=1,\dots,m\)</span>.</p>
<p>For instance:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">A</span> <span class="o">&lt;-</span> <span class="nf">rbind</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">),</span> <span class="nf">c</span><span class="p">(</span><span class="m">-1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">)))</span>
<span class="c1">##      [,1] [,2] [,3]</span>
<span class="c1">## [1,]    1    1    1</span>
<span class="c1">## [2,]   -1    1    0</span>
<span class="p">(</span><span class="n">B</span> <span class="o">&lt;-</span> <span class="nf">rbind</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span> <span class="m">-1</span><span class="p">),</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">),</span> <span class="nf">c</span><span class="p">(</span><span class="m">6</span><span class="p">,</span> <span class="m">1</span><span class="p">)))</span>
<span class="c1">##      [,1] [,2]</span>
<span class="c1">## [1,]    3   -1</span>
<span class="c1">## [2,]    1    2</span>
<span class="c1">## [3,]    6    1</span>
<span class="n">A</span> <span class="o">%*%</span> <span class="n">B</span>
<span class="c1">##      [,1] [,2]</span>
<span class="c1">## [1,]   10    2</span>
<span class="c1">## [2,]   -2    3</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When applying `<strong class="command">%*%</strong>` on one or more flat vectors,
their dimensionality will be promoted automatically to make
the operation possible. Note that, however,
<strong class="command">c</strong><code class="code docutils literal notranslate"><span class="pre">(a,</span> <span class="pre">b)</span> </code><strong class="command">%*%</strong><code class="code docutils literal notranslate"> </code><strong class="command">c</strong><code class="code docutils literal notranslate"><span class="pre">(c,</span> <span class="pre">d)</span></code>
gives a scalar <span class="math notranslate nohighlight">\(ac+bd\)</span>, and not a 2-by-2 matrix.</p>
</div>
<p>Further,
<strong class="command">crossprod</strong><code class="code docutils literal notranslate"><span class="pre">(A,</span> <span class="pre">B)</span></code> yields <span class="math notranslate nohighlight">\(\mathbf{A}^T \mathbf{B}\)</span> and
<strong class="command">tcrossprod</strong><code class="code docutils literal notranslate"><span class="pre">(A,</span> <span class="pre">B)</span></code> determines <span class="math notranslate nohighlight">\(\mathbf{A} \mathbf{B}^T\)</span>
more efficiently than relying on `<strong class="command">%*%</strong>`.
Note that we can omit the second argument and get
<span class="math notranslate nohighlight">\(\mathbf{A}^T \mathbf{A}\)</span> and <span class="math notranslate nohighlight">\(\mathbf{A} \mathbf{A}\)</span>, respectively</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">crossprod</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">))</span>  <span class="c1"># Euclidean norm squared</span>
<span class="c1">##      [,1]</span>
<span class="c1">## [1,]    2</span>
<span class="nf">crossprod</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">),</span> <span class="nf">c</span><span class="p">(</span><span class="m">-1</span><span class="p">,</span> <span class="m">1</span><span class="p">))</span>  <span class="c1"># dot product of two vectors</span>
<span class="c1">##      [,1]</span>
<span class="c1">## [1,]    0</span>
<span class="nf">crossprod</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>  <span class="c1"># same as t(A) %*% A, i.e., dot products of all column pairs</span>
<span class="c1">##      [,1] [,2] [,3]</span>
<span class="c1">## [1,]    2    0    1</span>
<span class="c1">## [2,]    0    2    1</span>
<span class="c1">## [3,]    1    1    1</span>
</pre></div>
</div>
<p>Recall that if the dot product of two vectors is equal to 0,
we say that they are orthogonal (perpendicular).</p>
<div class="proof proof-type-exercise" id="id40">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.18</span>
        
    </div><div class="proof-content">
<p>(*)
Write your own versions of <strong class="command">cov</strong> and <strong class="command">cor</strong>:
functions to compute the covariance and correlation matrices.
Make use of the fact that the former can be determined
with <strong class="command">crossprod</strong> based on a centred version of an input matrix.</p>
</div></div></section>
<section id="solving-systems-of-linear-equations">
<h3><span class="section-number">11.4.2. </span>Solving Systems of Linear Equations<a class="headerlink" href="#solving-systems-of-linear-equations" title="Permalink to this heading"></a></h3>
<p>The <strong class="command">solve</strong> function can be used to solve <em>m</em> systems
of <em>n</em> linear equations of the form
<span class="math notranslate nohighlight">\(\mathbf{A}\mathbf{X}=\mathbf{B}\)</span>,
where <span class="math notranslate nohighlight">\(\mathbf{A}\in\mathbb{R}^{n\times n}\)</span> and <span class="math notranslate nohighlight">\(\mathbf{X},\mathbf{B}\in\mathbb{R}^{n\times m}\)</span>
(via the LU decomposition with partial pivoting and row interchanges).</p>
</section>
<section id="norms-and-metrics">
<h3><span class="section-number">11.4.3. </span>Norms and Metrics<a class="headerlink" href="#norms-and-metrics" title="Permalink to this heading"></a></h3>
<p>Given an <em>n</em>-by-<em>m</em> matrix <span class="math notranslate nohighlight">\(\mathbf{A}\)</span>,
calling <strong class="command">norm</strong><code class="code docutils literal notranslate"><span class="pre">(A,</span> <span class="pre">&quot;1&quot;)</span></code>,
<strong class="command">norm</strong><code class="code docutils literal notranslate"><span class="pre">(A,</span> <span class="pre">&quot;2&quot;)</span></code>,
and <strong class="command">norm</strong><code class="code docutils literal notranslate"><span class="pre">(A,</span> <span class="pre">&quot;I&quot;)</span></code>,
we can compute the operator norms:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{array}{lcl}
\|\mathbf{A}\|_1 &amp;=&amp; \max_{j=1,\dots,m} \sum_{i=1}^n |a_{i,j}|,\\
\|\mathbf{A}\|_2 &amp;=&amp; \sigma_1(\mathbf{A}) = \sup_{\mathbf{0}\neq\mathbf{x}\in\mathbb{R}^m}
                      \frac{\|\mathbf{A}\mathbf{x}\|_2}{\|\mathbf{x}\|_2} \\
\|\mathbf{A}\|_I &amp;=&amp; \max_{i=1,\dots,n} \sum_{j=1}^m |a_{i,j}|,\\
\end{array}
\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(\sigma_1\)</span> gives the largest singular value (see below).</p>
<p>Also, passing <code class="docutils literal notranslate"><span class="pre">&quot;F&quot;</span></code> as the second argument
yields the Frobenius norm,
<span class="math notranslate nohighlight">\(\|\mathbf{A}\|_F = \sqrt{\sum_{i=1}^n \sum_{j=1}^m a_{i,j}^2}\)</span>,
and <code class="docutils literal notranslate"><span class="pre">&quot;M&quot;</span></code> computes the max norm,
<span class="math notranslate nohighlight">\(\|\mathbf{A}\|_M = \max_{{i=1,\dots,n\atop j=1,\dots,m}} |a_{i,j}|\)</span>.</p>
<p>Note that if <span class="math notranslate nohighlight">\(\mathbf{A}\)</span> is a column vector,
then
<span class="math notranslate nohighlight">\(\|\mathbf{A}\|_F\)</span> and <span class="math notranslate nohighlight">\(\|\mathbf{A}\|_2\)</span> are equivalent
and are referred to as the Euclidean norm.
Moreover, <span class="math notranslate nohighlight">\(\|\mathbf{A}\|_M=\|\mathbf{A}\|_I\)</span> give the supremum norm
and outputs <span class="math notranslate nohighlight">\(\|\mathbf{A}\|_1\)</span> the Manhattan (taxicab) one.</p>
<div class="proof proof-type-exercise" id="id41">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.19</span>
        
    </div><div class="proof-content">
<p>Given an <em>n</em>-by-<em>m</em> matrix <span class="math notranslate nohighlight">\(\mathbf{A}\)</span> representing
<em>m</em> vectors in <span class="math notranslate nohighlight">\(\mathbb{R}^n\)</span>, normalise each column
so that you obtain <em>m</em> unit vectors,
i.e., whose Euclidean norm is 1.</p>
</div></div><p>Further, <strong class="command">dist</strong> determines all pairwise distances
between a set of <em>n</em> vectors in <span class="math notranslate nohighlight">\(\mathbb{R}^m\)</span>,
written as a <em>n</em> by <em>m</em> matrix.</p>
<p>For example, let us consider three vectors in <span class="math notranslate nohighlight">\(\mathbb{R}^2\)</span>:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">X</span> <span class="o">&lt;-</span> <span class="nf">rbind</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">),</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">-2</span><span class="p">),</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">)))</span>
<span class="c1">##      [,1] [,2]</span>
<span class="c1">## [1,]    1    1</span>
<span class="c1">## [2,]    1   -2</span>
<span class="c1">## [3,]    0    0</span>
<span class="nf">as.matrix</span><span class="p">(</span><span class="nf">dist</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="s">&quot;euclidean&quot;</span><span class="p">))</span>
<span class="c1">##        1      2      3</span>
<span class="c1">## 1 0.0000 3.0000 1.4142</span>
<span class="c1">## 2 3.0000 0.0000 2.2361</span>
<span class="c1">## 3 1.4142 2.2361 0.0000</span>
</pre></div>
</div>
<p>From that we see that the distance between the 1st and the 3rd vector
is ca. 1.41421.
Euclidean, maximum, Manhattan, and Canberra distances/metrics
are available, amongst others.</p>
<div class="proof proof-type-exercise" id="id42">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.20</span>
        
    </div><div class="proof-content">
<p><strong class="command">dist</strong> returns an object of S3 class <code class="docutils literal notranslate"><span class="pre">dist</span></code>.
Inspect how it is represented.</p>
</div></div><div class="proof proof-type-example" id="id43">

    <div class="proof-title">
        <span class="proof-type">Example 11.21</span>
        
    </div><div class="proof-content">
<p><strong class="command">adist</strong> implements a couple of string metrics.
For example:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;spam&quot;</span><span class="p">,</span> <span class="s">&quot;bacon&quot;</span><span class="p">,</span> <span class="s">&quot;eggs&quot;</span><span class="p">,</span> <span class="s">&quot;spa&quot;</span><span class="p">,</span> <span class="s">&quot;spams&quot;</span><span class="p">,</span> <span class="s">&quot;legs&quot;</span><span class="p">)</span>
<span class="nf">names</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="nf">x</span>
<span class="p">(</span><span class="n">d</span> <span class="o">&lt;-</span> <span class="nf">adist</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="c1">##       spam bacon eggs spa spams legs</span>
<span class="c1">## spam     0     5    4   1     1    4</span>
<span class="c1">## bacon    5     0    5   5     5    5</span>
<span class="c1">## eggs     4     5    0   4     4    2</span>
<span class="c1">## spa      1     5    4   0     2    4</span>
<span class="c1">## spams    1     5    4   2     0    4</span>
<span class="c1">## legs     4     5    2   4     4    0</span>
</pre></div>
</div>
<p>gives the Levenshtein distances between each pair of strings.
In particular, we need two edit operations (character
insertions, deletions, or replacements) to turn <code class="docutils literal notranslate"><span class="pre">&quot;eggs&quot;</span></code> into <code class="docutils literal notranslate"><span class="pre">&quot;legs&quot;</span></code>
(add <code class="docutils literal notranslate"><span class="pre">l</span></code> and remove <code class="docutils literal notranslate"><span class="pre">g</span></code>).</p>
</div></div><div class="proof proof-type-example" id="id44">

    <div class="proof-title">
        <span class="proof-type">Example 11.22</span>
        
    </div><div class="proof-content">
<p>Objects of class <code class="docutils literal notranslate"><span class="pre">dist</span></code> can be used to perform hierarchical
clusterings of datasets. For example:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">h</span> <span class="o">&lt;-</span> <span class="nf">hclust</span><span class="p">(</span><span class="nf">as.dist</span><span class="p">(</span><span class="n">d</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="s">&quot;average&quot;</span><span class="p">)</span>  <span class="c1"># see also: plot(h, labels=x)</span>
<span class="nf">cutree</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="m">3</span><span class="p">)</span>
<span class="c1">##  spam bacon  eggs   spa spams  legs </span>
<span class="c1">##     1     2     3     1     1     3</span>
</pre></div>
</div>
<p>yields a grouping into 3 clusters determined by the average linkage
(<code class="docutils literal notranslate"><span class="pre">&quot;legs&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;eggs&quot;</span></code> are grouped together, <code class="docutils literal notranslate"><span class="pre">&quot;spam&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;spa&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;spams&quot;</span></code>
form another cluster, and <code class="docutils literal notranslate"><span class="pre">&quot;bacon&quot;</span></code> is a singleton).</p>
</div></div></section>
<section id="eigenvalues-and-eigenvectors">
<h3><span class="section-number">11.4.4. </span>Eigenvalues and Eigenvectors<a class="headerlink" href="#eigenvalues-and-eigenvectors" title="Permalink to this heading"></a></h3>
<p><strong class="command">eigen</strong> returns a sequence of eigenvalues
<span class="math notranslate nohighlight">\((\lambda_1,\dots,\lambda_n)\)</span> (ordered nondecreasingly w.r.t. <span class="math notranslate nohighlight">\(|\lambda_i|\)</span>)
and a matrix <span class="math notranslate nohighlight">\(\mathbf{V}\)</span> whose columns define the corresponding
eigenvectors (scaled to unit length) of a given matrix <span class="math notranslate nohighlight">\(\mathbf{X}\)</span>.
To recall, by definition it holds that
<span class="math notranslate nohighlight">\(\mathbf{X}\mathbf{v}_{\cdot,i}=\lambda_i\mathbf{v}_{\cdot,i}\)</span>.</p>
<p>Here are the eigenvalues and the corresponding eigenvectors
of an example matrix (defining rotation in 2D by <span class="math notranslate nohighlight">\(\pi/3\)</span>):</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">R</span> <span class="o">&lt;-</span> <span class="nf">rbind</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="nf">cos</span><span class="p">(</span><span class="kc">pi</span><span class="o">/</span><span class="m">3</span><span class="p">),</span> <span class="o">-</span><span class="nf">sin</span><span class="p">(</span><span class="kc">pi</span><span class="o">/</span><span class="m">3</span><span class="p">)),</span> <span class="nf">c</span><span class="p">(</span><span class="nf">sin</span><span class="p">(</span><span class="kc">pi</span><span class="o">/</span><span class="m">3</span><span class="p">),</span> <span class="nf">cos</span><span class="p">(</span><span class="kc">pi</span><span class="o">/</span><span class="m">3</span><span class="p">))))</span>
<span class="c1">##         [,1]     [,2]</span>
<span class="c1">## [1,] 0.50000 -0.86603</span>
<span class="c1">## [2,] 0.86603  0.50000</span>
<span class="nf">eigen</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
<span class="c1">## eigen() decomposition</span>
<span class="c1">## $values</span>
<span class="c1">## [1] 0.5+0.86603i 0.5-0.86603i</span>
<span class="c1">## </span>
<span class="c1">## $vectors</span>
<span class="c1">##                  [,1]             [,2]</span>
<span class="c1">## [1,] 0.70711+0.00000i 0.70711+0.00000i</span>
<span class="c1">## [2,] 0.00000-0.70711i 0.00000+0.70711i</span>
</pre></div>
</div>
<div class="proof proof-type-example" id="id45">

    <div class="proof-title">
        <span class="proof-type">Example 11.23</span>
        
    </div><div class="proof-content">
<p>Consider a pseudorandom sample from a bivariate<a class="footnote-reference brackets" href="#footcopula" id="id9">6</a> normal
distribution; see <a class="reference internal" href="#fig-eigen-prcomp-1"><span class="std std-numref">Figure 11.1</span></a>.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">Z</span> <span class="o">&lt;-</span> <span class="nf">matrix</span><span class="p">(</span><span class="nf">rnorm</span><span class="p">(</span><span class="m">2000</span><span class="p">),</span> <span class="n">ncol</span><span class="o">=</span><span class="m">2</span><span class="p">)</span>  <span class="c1"># independent N(0, 1)</span>
<span class="n">Z</span> <span class="o">&lt;-</span> <span class="n">Z</span> <span class="o">%*%</span> <span class="nf">rbind</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">),</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="nf">sqrt</span><span class="p">(</span><span class="m">5</span><span class="p">)))</span>  <span class="c1"># scaling</span>
<span class="n">Z</span> <span class="o">&lt;-</span> <span class="n">Z</span> <span class="o">%*%</span> <span class="n">R</span>  <span class="c1"># rotation</span>
<span class="n">Z</span> <span class="o">&lt;-</span> <span class="nf">t</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="m">-5</span><span class="p">)</span> <span class="o">+</span> <span class="nf">t</span><span class="p">(</span><span class="n">Z</span><span class="p">))</span>  <span class="c1"># translation</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span> <span class="n">asp</span><span class="o">=</span><span class="m">1</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-default" id="id46">
<span id="fig-eigen-prcomp-1"></span><img alt="../_images/eigen-prcomp-1-1.png" src="../_images/eigen-prcomp-1-1.png" />
<figcaption>
<p><span class="caption-number">Figure 11.1 </span><span class="caption-text">Example bivariate normal sample</span><a class="headerlink" href="#id46" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>It is known that eigenvectors of the covariance matrix
correspond to the principal components of the original dataset
and the eigenvalues give the variance explained by them:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">eigen</span><span class="p">(</span><span class="nf">cov</span><span class="p">(</span><span class="n">Z</span><span class="p">))</span>
<span class="c1">## eigen() decomposition</span>
<span class="c1">## $values</span>
<span class="c1">## [1] 5.18609 0.98386</span>
<span class="c1">## </span>
<span class="c1">## $vectors</span>
<span class="c1">##          [,1]     [,2]</span>
<span class="c1">## [1,] -0.86715  0.49804</span>
<span class="c1">## [2,] -0.49804 -0.86715</span>
</pre></div>
</div>
<p>this roughly corresponds to the principal directions
<span class="math notranslate nohighlight">\([\sin(\pi/3), \cos(\pi/3)]\)</span> and the thereto-orthogonal
<span class="math notranslate nohighlight">\([\cos(\pi/3), -\sin(\pi/3)]\)</span>
with variances of 5 and 1, respectively. Still, this method of performing
a PCA is not particularly numerically stable; see below for an alternative.</p>
</div></div></section>
<section id="qr-decomposition">
<h3><span class="section-number">11.4.5. </span>QR Decomposition<a class="headerlink" href="#qr-decomposition" title="Permalink to this heading"></a></h3>
<p>We say that a real <em>n</em>-by-<em>m</em> matrix <span class="math notranslate nohighlight">\(\mathbf{Q}\)</span>, <span class="math notranslate nohighlight">\(n\ge m\)</span>,
is orthogonal, whenever <span class="math notranslate nohighlight">\(\mathbf{Q}^T \mathbf{Q}  = \mathbf{I}\)</span>
(identity matrix) which is equivalent to its columns being
orthogonal unit vectors
(note that if <span class="math notranslate nohighlight">\(\mathbf{Q}\)</span> is a square matrix, then
<span class="math notranslate nohighlight">\(\mathbf{Q}^T=\mathbf{Q}^{-1}\)</span> if and only if
<span class="math notranslate nohighlight">\(\mathbf{Q}^T \mathbf{Q} = \mathbf{Q} \mathbf{Q}^T = \mathbf{I}\)</span>).</p>
<p>Let <span class="math notranslate nohighlight">\(\mathbf{A}\)</span> be a real<a class="footnote-reference brackets" href="#footcomplexqr" id="id10">7</a> <em>n</em>-by-<em>m</em> matrix with <span class="math notranslate nohighlight">\(n\ge m\)</span>.
Then <span class="math notranslate nohighlight">\(\mathbf{A}=\mathbf{Q}\mathbf{R}\)</span> is its QR
decomposition (in the so-called narrow form),
if <span class="math notranslate nohighlight">\(\mathbf{Q}\)</span> is an orthogonal <em>n</em>-by-<em>m</em> matrix
and <span class="math notranslate nohighlight">\(\mathbf{R}\)</span> is an upper triangular
<em>m</em>-by-<em>m</em> one.</p>
<p>The  <strong class="command">qr</strong> function returns an object of S3 class <code class="docutils literal notranslate"><span class="pre">qr</span></code>
from which we can extract  the two components; see the
<strong class="command">qr.Q</strong> and <strong class="command">qr.R</strong> functions.</p>
<div class="proof proof-type-example" id="id47">

    <div class="proof-title">
        <span class="proof-type">Example 11.24</span>
        
    </div><div class="proof-content">
<p>Let <span class="math notranslate nohighlight">\(\mathbf{X}\)</span> be an <em>n</em>-by-<em>m</em> data matrix, representing
<em>n</em> points in <span class="math notranslate nohighlight">\(\mathbb{R}^m\)</span>, and a vector
<span class="math notranslate nohighlight">\(\mathbf{y}\in\mathbb{R}^n\)</span> of the <em>desired</em> outputs corresponding
to each input.
For fitting a linear model <span class="math notranslate nohighlight">\(\mathbf{x}^T \boldsymbol\theta\)</span>,
where <span class="math notranslate nohighlight">\(\boldsymbol\theta\)</span> is a vector of <em>m</em> parameters,
we can use the method of least squares, which minimises</p>
<div class="math notranslate nohighlight">
\[
\mathcal{L}(\boldsymbol\theta) = \sum_{i=1}^n \left(
\mathbf{x}_{i,\cdot}^T \boldsymbol\theta  - y_i
\right)^2
=
\|\mathbf{X} \boldsymbol\theta - \mathbf{y}\|_2^2
\]</div>
<p>It might be shown that if
<span class="math notranslate nohighlight">\(\mathbf{X}=\mathbf{Q}\mathbf{R}\)</span>,
then <span class="math notranslate nohighlight">\(\boldsymbol\theta =
\left(\mathbf{X}^T \mathbf{X} \right)^{-1} \mathbf{X}^T \mathbf{y}
= \mathbf{R}^{-1}\mathbf{Q}^T\mathbf{y}\)</span>, which can conveniently be determined
via a call to <strong class="command">qr.coef</strong>.</p>
<p>In particular, we can fit a simple linear regression
model <span class="math notranslate nohighlight">\(y=ax+b\)</span> by considering <span class="math notranslate nohighlight">\(\mathbf{X} = [x, 1]\)</span> and
<span class="math notranslate nohighlight">\(\boldsymbol\theta = [a, b]\)</span>,
for example (see  <a class="reference internal" href="#fig-qr-lm"><span class="std std-numref">Figure 11.2</span></a>):</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">&lt;-</span> <span class="n">cars</span><span class="p">[[</span><span class="s">&quot;speed&quot;</span><span class="p">]]</span>
<span class="n">y</span> <span class="o">&lt;-</span> <span class="n">cars</span><span class="p">[[</span><span class="s">&quot;dist&quot;</span><span class="p">]]</span>
<span class="n">X</span> <span class="o">&lt;-</span> <span class="nf">cbind</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span>  <span class="c1"># the model is theta[1]*x + theta[2]*1</span>
<span class="n">qrX</span> <span class="o">&lt;-</span> <span class="nf">qr</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="p">(</span><span class="n">theta</span> <span class="o">&lt;-</span> <span class="nf">solve</span><span class="p">(</span><span class="nf">qr.R</span><span class="p">(</span><span class="n">qrX</span><span class="p">))</span> <span class="o">%*%</span> <span class="nf">t</span><span class="p">(</span><span class="nf">qr.Q</span><span class="p">(</span><span class="n">qrX</span><span class="p">))</span> <span class="o">%*%</span> <span class="n">y</span><span class="p">)</span>   <span class="c1"># or: qr.coef(qrX, y)</span>
<span class="c1">##       [,1]</span>
<span class="c1">## x   3.9324</span>
<span class="c1">##   -17.5791</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">xlab</span><span class="o">=</span><span class="s">&quot;speed&quot;</span><span class="p">,</span> <span class="n">ylab</span><span class="o">=</span><span class="s">&quot;dist&quot;</span><span class="p">)</span>  <span class="c1"># scatter plot</span>
<span class="nf">abline</span><span class="p">(</span><span class="n">theta</span><span class="p">[</span><span class="m">2</span><span class="p">],</span> <span class="n">theta</span><span class="p">[</span><span class="m">1</span><span class="p">],</span> <span class="n">lty</span><span class="o">=</span><span class="m">2</span><span class="p">)</span>  <span class="c1"># add the regression line</span>
</pre></div>
</div>
<figure class="align-default" id="id48">
<span id="fig-qr-lm"></span><img alt="../_images/qr-lm-1.png" src="../_images/qr-lm-1.png" />
<figcaption>
<p><span class="caption-number">Figure 11.2 </span><span class="caption-text">The built-in <code class="docutils literal notranslate"><span class="pre">cars</span></code> dataset and the fitted regression line</span><a class="headerlink" href="#id48" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>Note that <strong class="command">solve</strong> with one argument determines the inverse
of a given matrix.
The fitted model is <span class="math notranslate nohighlight">\(y=3.93241x-17.5791\)</span>.</p>
<p>The same approach is used by <strong class="command">lm.fit</strong>, which is
the workhorse behind the <strong class="command">lm</strong> method accepting an R formula
(which some readers might be familiar with; compare <a class="reference internal" href="320-language.html#sec-formula"><span class="std std-numref">Section 15.2</span></a>).</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">lm.fit</span><span class="p">(</span><span class="nf">cbind</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="m">1</span><span class="p">),</span> <span class="n">y</span><span class="p">)[[</span><span class="s">&quot;coefficients&quot;</span><span class="p">]]</span>  <span class="c1"># also: lm(dist~speed, data=cars)</span>
<span class="c1">##        x          </span>
<span class="c1">##   3.9324 -17.5791</span>
</pre></div>
</div>
</div></div></section>
<section id="svd-decomposition">
<h3><span class="section-number">11.4.6. </span>SVD Decomposition<a class="headerlink" href="#svd-decomposition" title="Permalink to this heading"></a></h3>
<p>Given a real <em>n</em>-by-<em>m</em> matrix <span class="math notranslate nohighlight">\(\mathbf{X}\)</span>,
its singular value decomposition (SVD) is given by
<span class="math notranslate nohighlight">\(\mathbf{X}=\mathbf{U} \mathbf{D} \mathbf{V}^T\)</span>,
where <span class="math notranslate nohighlight">\(\mathbf{D}\)</span> is a <em>p</em>-by-<em>p</em> diagonal matrix
(featuring the so-called singular values of <span class="math notranslate nohighlight">\(\mathbf{X}\)</span>,
<span class="math notranslate nohighlight">\(d_{1,1}\ge\dots\ge d_{p,p}\ge 0\)</span>, <span class="math notranslate nohighlight">\(p=\min\{n,m\}\)</span>)
and <span class="math notranslate nohighlight">\(\mathbf{U}\)</span>, <span class="math notranslate nohighlight">\(\mathbf{V}\)</span> are orthogonal matrices
of size <em>n</em>-by-<em>p</em> and <em>m</em>-by-<em>p</em>, respectively.</p>
<p><strong class="command">svd</strong> may not only be used to determine the solution to
linear regression<a class="footnote-reference brackets" href="#footregsvd" id="id11">8</a>
but also to perform the principal component analysis<a class="footnote-reference brackets" href="#footpcasvd" id="id12">9</a>.
Namely, <span class="math notranslate nohighlight">\(\mathbf{V}\)</span> gives the eigenvectors of <span class="math notranslate nohighlight">\(\mathbf{X}^T \mathbf{X}\)</span>.
Assuming that <span class="math notranslate nohighlight">\(\mathbf{X}\)</span> is centred at <span class="math notranslate nohighlight">\(\boldsymbol{0}\)</span>,
the latter is precisely its scaled covariance matrix.</p>
<div class="proof proof-type-example" id="id49">

    <div class="proof-title">
        <span class="proof-type">Example 11.25</span>
        
    </div><div class="proof-content">
<p>Continuing the PCA example above, we can determine the principal
directions also by calling:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">Zc</span> <span class="o">&lt;-</span> <span class="nf">apply</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">x</span><span class="o">-</span><span class="nf">mean</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>  <span class="c1"># centred version of Z</span>
<span class="nf">svd</span><span class="p">(</span><span class="n">Zc</span><span class="p">)[[</span><span class="s">&quot;v&quot;</span><span class="p">]]</span>
<span class="c1">##          [,1]     [,2]</span>
<span class="c1">## [1,] -0.86715  0.49804</span>
<span class="c1">## [2,] -0.49804 -0.86715</span>
</pre></div>
</div>
</div></div></section>
</section>
<section id="s4-classes">
<span id="sec-s4"></span><h2><span class="section-number">11.5. </span>S4 Classes (*)<a class="headerlink" href="#s4-classes" title="Permalink to this heading"></a></h2>
<p>The concept of the S3-style object oriented programming
is based on a brilliantly simple idea (see <a class="reference internal" href="220-s3.html#chap-s3"><span class="std std-numref">Chapter 10</span></a>):
calling a generic <strong class="command">f</strong><code class="code docutils literal notranslate"><span class="pre">(x)</span></code>
automatically dispatches to a method
<strong class="command">f.class_of_x</strong><code class="code docutils literal notranslate"><span class="pre">(x)</span></code>
or
<strong class="command">f.default</strong><code class="code docutils literal notranslate"><span class="pre">(x)</span></code> in the case where the former does not exist.
Naturally, it has some inherent limitations:</p>
<ul class="simple">
<li><p>classes cannot be formally defined; the <code class="docutils literal notranslate"><span class="pre">class</span></code> attribute
may be assigned arbitrarily onto any object<a class="footnote-reference brackets" href="#foots3fix1" id="id13">10</a>,</p></li>
<li><p>argument dispatch is performed only<a class="footnote-reference brackets" href="#footmutdis" id="id14">11</a> with regard to one data
type<a class="footnote-reference brackets" href="#foots3fix2" id="id15">12</a>.</p></li>
</ul>
<p>In most cases, and with appropriate level of mindfulness, this is not
a problem at all.
However, it is a typical condition of programmers who come to our world
from more mainstream languages (e.g., C++; yours truly included)
until they appreciate the true beauty of R’s being somewhat different.
Before they fully develop such an acquired taste, though,
they grow restless as
“R is not a real object oriented system because it lacks polymorphism,
encapsulation, formal inheritance, and so on and so forth,
and something must be done about it”. The truth is that it had not
have to, but with high probability it would have anyway
in one way or another.</p>
<p>And so when the fourth version of the S language was introduced in 1998
(see <span id="id16">[<a class="reference internal" href="999-bibliography.html#id45" title="Chambers, J.M. (1998).  Programming with Data. A Guide to the S Language. Springer-Verlag.">4</a>]</span>),
it brought a new object oriented system which we are used to referring
to as S4. Its R version has been implemented in the <strong class="program">methods</strong>
package. Below we discuss it briefly; for more details, see
<strong class="command">help</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;Classes_Details&quot;)</span></code> and <strong class="command">help</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;Methods_Details&quot;)</span></code> as well as
<span id="id17">[<a class="reference internal" href="999-bibliography.html#id15" title="Chambers, J.M. (2008).  Software for Data Analysis. Programming with R. Springer.">5</a>]</span> and <span id="id18">[<a class="reference internal" href="999-bibliography.html#id17" title="Chambers, J.M. (2016).  Extending R. Chapman &amp; Hall.">6</a>]</span>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>(*)
S4 was loosely inspired by the Common Lisp Object System
(with its <code class="docutils literal notranslate"><span class="pre">defclass</span></code>, <code class="docutils literal notranslate"><span class="pre">defmethod</span></code>, etc.; see, e.g., <span id="id19">[<a class="reference internal" href="999-bibliography.html#id4" title="DeMichiel, L.G., Gabriel, R.P. (1987).  The Common Lisp Object System: An overview. ECOOP. URL: https://www.dreamsongs.com/Files/ECOOP.pdf.">15</a>]</span>).
In the current author’s opinion, the S4 system is somewhat an afterthought.
Due to appendages like this, R seems like a patchwork language;
suffice it to say that it was not the
last attempt to do a somewhat more real OOP in the overall functional
R: the story will continue in <a class="reference internal" href="330-environment.html#sec-refclass"><span class="std std-numref">Section 16.3</span></a>.</p>
<p>The main problem with all the OOP approaches is that each of them is
parallel to S3 which never lost its popularity and is still at the
very core of our language.
We are thus covering them for the sake of completeness,
because that’s what must be done. After all,
with non-zero probability, the reader will sooner or later
come across such objects
(e.g., below we explain the meaning of notation like <code class="docutils literal notranslate"><span class="pre">x&#64;slot</span></code>).
Also, yours truly rebelliously suggests taking
statements such as
“for new projects, it is recommended to use the more flexible
and robust S4 scheme provided in the <strong class="program">methods</strong> package”
(see <strong class="command">help</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;UseMethod&quot;)</span></code>) with a pinch of salt.</p>
</div>
<section id="defining-s4-classes">
<h3><span class="section-number">11.5.1. </span>Defining S4 Classes<a class="headerlink" href="#defining-s4-classes" title="Permalink to this heading"></a></h3>
<p>An S4 class can formally be registered by means of a call to
<strong class="command">setClass</strong>.</p>
<p>For instance:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;methods&quot;</span><span class="p">)</span>  <span class="c1"># in the case where it is not auto-loaded</span>
<span class="nf">setClass</span><span class="p">(</span><span class="s">&quot;categorical&quot;</span><span class="p">,</span> <span class="n">slots</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s">&quot;integer&quot;</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="s">&quot;character&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>defines a class named <code class="docutils literal notranslate"><span class="pre">categorical</span></code> with two slots
<code class="docutils literal notranslate"><span class="pre">data</span></code> and <code class="docutils literal notranslate"><span class="pre">levels</span></code> being integer and character vectors, respectively.
Note that this notation is already quite peculiar: there is no assignment
which would suggest that we have introduced something novel.</p>
<p>An object of the above class can be instantiated
by calling <strong class="command">new</strong>:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">z</span> <span class="o">&lt;-</span> <span class="nf">new</span><span class="p">(</span><span class="s">&quot;categorical&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1L</span><span class="p">,</span> <span class="m">2L</span><span class="p">,</span> <span class="m">2L</span><span class="p">,</span> <span class="m">1L</span><span class="p">,</span> <span class="m">1L</span><span class="p">),</span> <span class="n">levels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="s">&quot;b&quot;</span><span class="p">))</span>
<span class="nf">print</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
<span class="c1">## An object of class &quot;categorical&quot;</span>
<span class="c1">## Slot &quot;data&quot;:</span>
<span class="c1">## [1] 1 2 2 1 1</span>
<span class="c1">## </span>
<span class="c1">## Slot &quot;levels&quot;:</span>
<span class="c1">## [1] &quot;a&quot; &quot;b&quot;</span>
</pre></div>
</div>
<p>That <code class="docutils literal notranslate"><span class="pre">z</span></code> is of the recently-introduced class can be verified as follows:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">is</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="s">&quot;categorical&quot;</span><span class="p">)</span>
<span class="c1">## [1] TRUE</span>
<span class="nf">class</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>  <span class="c1"># also: attr(z, &quot;class&quot;)</span>
<span class="c1">## [1] &quot;categorical&quot;</span>
<span class="c1">## attr(,&quot;package&quot;)</span>
<span class="c1">## [1] &quot;.GlobalEnv&quot;</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Some R packages will be importing from the <strong class="program">methods</strong>
only for the sake of being able to access the convenient <strong class="command">is</strong>
function – it does not mean they are defining new S4 classes.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>S4 objects are marked as being of the following basic type:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">typeof</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
<span class="c1">## [1] &quot;S4&quot;</span>
</pre></div>
</div>
<p>For technical details on how they are internally represented,
see Section 1.12 in <span id="id20">[<a class="reference internal" href="999-bibliography.html#id10" title="R Development Core Team. (2023).  R Internals. URL: https://CRAN.R-project.org/doc/manuals/r-release/R-ints.html.">48</a>]</span>.
In particular, in our case, all the slots are simply
stored as object attributes:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">attributes</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
<span class="c1">## $data</span>
<span class="c1">## [1] 1 2 2 1 1</span>
<span class="c1">## </span>
<span class="c1">## $levels</span>
<span class="c1">## [1] &quot;a&quot; &quot;b&quot;</span>
<span class="c1">## </span>
<span class="c1">## $class</span>
<span class="c1">## [1] &quot;categorical&quot;</span>
<span class="c1">## attr(,&quot;package&quot;)</span>
<span class="c1">## [1] &quot;.GlobalEnv&quot;</span>
</pre></div>
</div>
</div>
</section>
<section id="accessing-slots">
<h3><span class="section-number">11.5.2. </span>Accessing Slots<a class="headerlink" href="#accessing-slots" title="Permalink to this heading"></a></h3>
<p>Reading or writing slot contents can be done by means of the
`<strong class="command">&#64;</strong>` operator and
the <strong class="command">slot</strong> function or their replacement versions.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="o">@</span><span class="n">data</span>  <span class="c1"># or slot(z, &quot;data&quot;)</span>
<span class="c1">## [1] 1 2 2 1 1</span>
<span class="n">z</span><span class="o">@</span><span class="n">levels</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">,</span> <span class="s">&quot;B&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The `<strong class="command">&#64;</strong>` operator can only be used on S4 objects
and some sanity checks are automatically performed:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="o">@</span><span class="n">unknown</span> <span class="o">&lt;-</span> <span class="s">&quot;spam&quot;</span>
<span class="c1">## Error in (function (cl, name, valueClass) : &#39;unknown&#39; is not a slot in class &quot;categorical&quot;</span>
<span class="n">z</span><span class="o">@</span><span class="n">data</span> <span class="o">&lt;-</span> <span class="s">&quot;spam&quot;</span>
<span class="c1">## Error in (function (cl, name, valueClass) : assignment of an object of class &quot;character&quot; is not valid for @&#39;data&#39; in an object of class &quot;categorical&quot;; is(value, &quot;integer&quot;) is not TRUE</span>
</pre></div>
</div>
</div>
</section>
<section id="defining-methods">
<h3><span class="section-number">11.5.3. </span>Defining Methods<a class="headerlink" href="#defining-methods" title="Permalink to this heading"></a></h3>
<p>For the S4 counterparts of the S3 generics
(<a class="reference internal" href="220-s3.html#sec-s3-generic"><span class="std std-numref">Section 10.2</span></a>), see <strong class="command">help</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;setGeneric&quot;)</span></code>.
Luckily, there is a good degree of interoperability between
the S3 and S4 systems.</p>
<p>Let us start by introducing
a new method for the well-known <strong class="command">as.character</strong> generic.
Instead of defining <strong class="command">as.character.categorical</strong>,
we need to register a new routine with <strong class="command">setMethod</strong>.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">setMethod</span><span class="p">(</span>
    <span class="s">&quot;as.character&quot;</span><span class="p">,</span>     <span class="c1"># name of the generic</span>
    <span class="s">&quot;categorical&quot;</span><span class="p">,</span>      <span class="c1"># class of 1st arg; or: signature=c(x=&quot;categorical&quot;)</span>
    <span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="kc">...</span><span class="p">)</span>    <span class="c1"># method definition</span>
        <span class="n">x</span><span class="o">@</span><span class="n">levels</span><span class="p">[</span><span class="n">x</span><span class="o">@</span><span class="n">data</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Testing:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">as.character</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
<span class="c1">## [1] &quot;A&quot; &quot;B&quot; &quot;B&quot; &quot;A&quot; &quot;A&quot;</span>
</pre></div>
</div>
<p>The S4 counterpart of <strong class="command">print</strong> is <strong class="command">show</strong>:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">setMethod</span><span class="p">(</span>
    <span class="s">&quot;show&quot;</span><span class="p">,</span>
    <span class="s">&quot;categorical&quot;</span><span class="p">,</span>
    <span class="nf">function</span><span class="p">(</span><span class="n">object</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">x_character</span> <span class="o">&lt;-</span> <span class="nf">as.character</span><span class="p">(</span><span class="n">object</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">x_character</span><span class="p">)</span>  <span class="c1"># calls `print.default`</span>
        <span class="nf">cat</span><span class="p">(</span><span class="nf">sprintf</span><span class="p">(</span><span class="s">&quot;Categories: %s\n&quot;</span><span class="p">,</span>
            <span class="nf">paste</span><span class="p">(</span><span class="n">object</span><span class="o">@</span><span class="n">levels</span><span class="p">,</span> <span class="n">collapse</span><span class="o">=</span><span class="s">&quot;, &quot;</span><span class="p">)))</span>
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Interestingly, it is involved automatically
upon a call to <strong class="command">print</strong>:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">print</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>  <span class="c1"># calls `show` for `categorical`</span>
<span class="c1">## [1] &quot;A&quot; &quot;B&quot; &quot;B&quot; &quot;A&quot; &quot;A&quot;</span>
<span class="c1">## Categories: A, B</span>
</pre></div>
</div>
<p>Methods that dispatch on the type of multiple arguments
are possible too, for example:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">setMethod</span><span class="p">(</span>
    <span class="s">&quot;split&quot;</span><span class="p">,</span>
    <span class="nf">c</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">&quot;ANY&quot;</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="s">&quot;categorical&quot;</span><span class="p">),</span>
    <span class="nf">function </span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> <span class="kc">...</span><span class="p">)</span>
        <span class="nf">split</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nf">as.character</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="n">drop</span><span class="o">=</span><span class="n">drop</span><span class="p">,</span> <span class="kc">...</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>allows the first argument to be of any type (like a default method),
and:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">setMethod</span><span class="p">(</span>
    <span class="s">&quot;split&quot;</span><span class="p">,</span>
    <span class="nf">c</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">&quot;matrix&quot;</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="s">&quot;categorical&quot;</span><span class="p">),</span>
    <span class="nf">function </span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> <span class="kc">...</span><span class="p">)</span>
        <span class="nf">lapply</span><span class="p">(</span>
            <span class="nf">split</span><span class="p">(</span><span class="nf">seq_len</span><span class="p">(</span><span class="nf">NROW</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="n">f</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="n">drop</span><span class="p">,</span> <span class="kc">...</span><span class="p">),</span>  <span class="c1"># calls the above</span>
            <span class="nf">function</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">])</span>
<span class="p">)</span>
</pre></div>
</div>
<p>is a version tailored for matrices.
Testing:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">A</span> <span class="o">&lt;-</span> <span class="nf">matrix</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">35</span><span class="p">,</span> <span class="n">nrow</span><span class="o">=</span><span class="m">5</span><span class="p">)</span>  <span class="c1"># whatever</span>
<span class="nf">split</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>    <span class="c1"># matrix,categorical</span>
<span class="c1">## $A</span>
<span class="c1">##      [,1] [,2] [,3] [,4] [,5] [,6] [,7]</span>
<span class="c1">## [1,]    1    6   11   16   21   26   31</span>
<span class="c1">## [2,]    4    9   14   19   24   29   34</span>
<span class="c1">## [3,]    5   10   15   20   25   30   35</span>
<span class="c1">## </span>
<span class="c1">## $B</span>
<span class="c1">##      [,1] [,2] [,3] [,4] [,5] [,6] [,7]</span>
<span class="c1">## [1,]    2    7   12   17   22   27   32</span>
<span class="c1">## [2,]    3    8   13   18   23   28   33</span>
<span class="nf">split</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>  <span class="c1"># ANY,categorical</span>
<span class="c1">## $A</span>
<span class="c1">## [1] 1 4 5</span>
<span class="c1">## </span>
<span class="c1">## $B</span>
<span class="c1">## [1] 2 3</span>
</pre></div>
</div>
<div class="proof proof-type-exercise" id="id50">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.26</span>
        
    </div><div class="proof-content">
<p>Overload the `<strong class="command">[</strong>` operator for the <code class="docutils literal notranslate"><span class="pre">categorical</span></code>
class</p>
</div></div></section>
<section id="defining-constructors">
<h3><span class="section-number">11.5.4. </span>Defining Constructors<a class="headerlink" href="#defining-constructors" title="Permalink to this heading"></a></h3>
<p>We can also overload the <strong class="command">initialize</strong> method
which is automatically called by <strong class="command">new</strong>:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">setMethod</span><span class="p">(</span>
    <span class="s">&quot;initialize&quot;</span><span class="p">,</span>   <span class="c1"># class name</span>
    <span class="s">&quot;categorical&quot;</span><span class="p">,</span>  <span class="c1"># method name</span>
    <span class="nf">function</span><span class="p">(</span><span class="n">.Object</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>  <span class="c1"># the method itself</span>
        <span class="n">x</span> <span class="o">&lt;-</span> <span class="nf">as.character</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># see above</span>
        <span class="n">xu</span> <span class="o">&lt;-</span> <span class="nf">unique</span><span class="p">(</span><span class="nf">sort</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>  <span class="c1"># drops NAs</span>

        <span class="n">.Object</span><span class="o">@</span><span class="n">data</span> <span class="o">&lt;-</span> <span class="nf">match</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">xu</span><span class="p">)</span>
        <span class="n">.Object</span><span class="o">@</span><span class="n">levels</span> <span class="o">&lt;-</span> <span class="n">xu</span>

        <span class="n">.Object</span>  <span class="c1"># return value - a modified object</span>
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
<p>This allows for constructing new objects of class <code class="docutils literal notranslate"><span class="pre">categorical</span></code>
based on an object like <code class="docutils literal notranslate"><span class="pre">x</span></code> above, for instance:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">w</span> <span class="o">&lt;-</span> <span class="nf">new</span><span class="p">(</span><span class="s">&quot;categorical&quot;</span><span class="p">,</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="s">&quot;c&quot;</span><span class="p">,</span> <span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="s">&quot;d&quot;</span><span class="p">,</span> <span class="s">&quot;c&quot;</span><span class="p">))</span>
<span class="nf">print</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
<span class="c1">## [1] &quot;a&quot; &quot;c&quot; &quot;a&quot; &quot;a&quot; &quot;d&quot; &quot;c&quot;</span>
<span class="c1">## Categories: a, c, d</span>
</pre></div>
</div>
<p>Note that we have not set the two slots directly.
They were automatically taken care of by <strong class="command">initialize</strong>.</p>
<div class="proof proof-type-exercise" id="id51">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.27</span>
        
    </div><div class="proof-content">
<p>Set up a validating method for our class; see <strong class="command">help</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;setValidity&quot;)</span></code>.</p>
</div></div></section>
<section id="inheritance">
<h3><span class="section-number">11.5.5. </span>Inheritance<a class="headerlink" href="#inheritance" title="Permalink to this heading"></a></h3>
<p>New S4 classes can be derived from existing ones, for instance:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">setClass</span><span class="p">(</span><span class="s">&quot;binary&quot;</span><span class="p">,</span> <span class="n">contains</span><span class="o">=</span><span class="s">&quot;categorical&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>is a child class inhering all slots from its parent.
We can, for example, overload the initialisation method for it:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">setMethod</span><span class="p">(</span>
    <span class="s">&quot;initialize&quot;</span><span class="p">,</span>
    <span class="s">&quot;binary&quot;</span><span class="p">,</span>
    <span class="nf">function</span><span class="p">(</span><span class="n">.Object</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">x</span> <span class="o">&lt;-</span> <span class="nf">as.character</span><span class="p">(</span><span class="nf">as.integer</span><span class="p">(</span><span class="nf">as.logical</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
        <span class="n">xu</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;0&quot;</span><span class="p">,</span> <span class="s">&quot;1&quot;</span><span class="p">)</span>
        <span class="n">.Object</span><span class="o">@</span><span class="n">data</span> <span class="o">&lt;-</span> <span class="nf">match</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">xu</span><span class="p">)</span>
        <span class="n">.Object</span><span class="o">@</span><span class="n">levels</span> <span class="o">&lt;-</span> <span class="n">xu</span>
        <span class="n">.Object</span>
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Testing:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">new</span><span class="p">(</span><span class="s">&quot;binary&quot;</span><span class="p">,</span> <span class="nf">c</span><span class="p">(</span><span class="kc">TRUE</span><span class="p">,</span> <span class="kc">FALSE</span><span class="p">,</span> <span class="kc">TRUE</span><span class="p">,</span> <span class="kc">FALSE</span><span class="p">,</span> <span class="kc">NA</span><span class="p">,</span> <span class="kc">TRUE</span><span class="p">))</span>
<span class="c1">## [1] &quot;1&quot; &quot;0&quot; &quot;1&quot; &quot;0&quot; NA  &quot;1&quot;</span>
<span class="c1">## Categories: 0, 1</span>
</pre></div>
</div>
<p>Note that we are still using the <strong class="command">show</strong> method
of the parent class.</p>
</section>
<section id="a-note-on-the-matrix-package">
<h3><span class="section-number">11.5.6. </span>A Note on the <strong class="program">Matrix</strong> Package<a class="headerlink" href="#a-note-on-the-matrix-package" title="Permalink to this heading"></a></h3>
<p>The <strong class="program">Matrix</strong> package is perhaps the most widely known showcase of
the S4 object-orientation (and that is the reason why
we cover S4 in this very chapter). It defines classes and methods for
dense and sparse matrices, including rectangular, symmetric,
triangular, band, and diagonal ones.</p>
<p>For instance, large graph (e.g., in network sciences)
or preference (e.g., in recommender systems) data can be represented
using sparse matrices (those which feature many 0s; after all,
it is extremely more common for two vertices in a network
to <em>not</em> be joined by an edge than to be connected).</p>
<p>For example:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="s">&quot;Matrix&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="n">A</span> <span class="o">&lt;-</span> <span class="nf">Diagonal</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">))</span>
<span class="c1">## 5 x 5 diagonal matrix of class &quot;ddiMatrix&quot;</span>
<span class="c1">##      [,1] [,2] [,3] [,4] [,5]</span>
<span class="c1">## [1,]    1    .    .    .    .</span>
<span class="c1">## [2,]    .    2    .    .    .</span>
<span class="c1">## [3,]    .    .    3    .    .</span>
<span class="c1">## [4,]    .    .    .    4    .</span>
<span class="c1">## [5,]    .    .    .    .    5</span>
</pre></div>
</div>
<p>created a real diagonal matrix. Moreover:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">B</span> <span class="o">&lt;-</span> <span class="nf">as</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="s">&quot;sparseMatrix&quot;</span><span class="p">)</span>
<span class="n">B</span><span class="p">[</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="m">7</span>
<span class="n">B</span><span class="p">[</span><span class="m">4</span><span class="p">,</span> <span class="m">1</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="m">42</span>
<span class="nf">print</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>
<span class="c1">## 5 x 5 sparse Matrix of class &quot;dgCMatrix&quot;</span>
<span class="c1">##                </span>
<span class="c1">## [1,]  1 7 . . .</span>
<span class="c1">## [2,]  . 2 . . .</span>
<span class="c1">## [3,]  . . 3 . .</span>
<span class="c1">## [4,] 42 . . 4 .</span>
<span class="c1">## [5,]  . . . . 5</span>
</pre></div>
</div>
<p>yields a general sparse real matrix in the CRC
(compressed, sparse, column-oriented) format.</p>
<p>For more information on the package, see
<strong class="command">vignette</strong><code class="code docutils literal notranslate"><span class="pre">(package=&quot;Matrix&quot;)</span></code>.</p>
</section>
</section>
<section id="exercises">
<h2><span class="section-number">11.6. </span>Exercises<a class="headerlink" href="#exercises" title="Permalink to this heading"></a></h2>
<div class="proof proof-type-exercise" id="id52">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.28</span>
        
    </div><div class="proof-content">
<p>Let <code class="docutils literal notranslate"><span class="pre">X</span></code> be a matrix with <code class="docutils literal notranslate"><span class="pre">dimnames</span></code> set, e.g.:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">&lt;-</span> <span class="nf">matrix</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">12</span><span class="p">,</span> <span class="n">byrow</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">nrow</span><span class="o">=</span><span class="m">3</span><span class="p">)</span>      <span class="c1"># example matrix</span>
<span class="nf">dimnames</span><span class="p">(</span><span class="n">X</span><span class="p">)[[</span><span class="m">2</span><span class="p">]]</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="s">&quot;b&quot;</span><span class="p">,</span> <span class="s">&quot;c&quot;</span><span class="p">,</span> <span class="s">&quot;d&quot;</span><span class="p">)</span>  <span class="c1"># set column names</span>
<span class="nf">print</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="c1">##      a  b  c  d</span>
<span class="c1">## [1,] 1  2  3  4</span>
<span class="c1">## [2,] 5  6  7  8</span>
<span class="c1">## [3,] 9 10 11 12</span>
</pre></div>
</div>
<p>Explain (in your own words) the meaning of the following expressions
involving matrix subsetting. Note that not each of them is valid.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">X[1,</span> <span class="pre">]</span></code>,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">X[,</span> <span class="pre">3]</span></code>,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">X[,</span> <span class="pre">3,</span> <span class="pre">drop=FALSE]</span></code>,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">X[3]</span></code>,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">X[,</span> <span class="pre">&quot;a&quot;]</span></code>,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">X[,</span> </code><strong class="command">c</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;a&quot;,</span> <span class="pre">&quot;b&quot;,</span> <span class="pre">&quot;c&quot;)]</span></code>,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">X[,</span> <span class="pre">-2]</span></code>,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">X[X[,1]</span> <span class="pre">&gt;</span> <span class="pre">5,</span> <span class="pre">]</span></code>,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">X[X[,1]&gt;5,</span> </code><strong class="command">c</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;a&quot;,</span> <span class="pre">&quot;b&quot;,</span> <span class="pre">&quot;c&quot;)]</span></code>,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">X[X[,1]&gt;=5</span> <span class="pre">&amp;</span> <span class="pre">X[,1]&lt;=10,</span> <span class="pre">]</span></code>,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">X[X[,1]&gt;=5</span> <span class="pre">&amp;</span> <span class="pre">X[,1]&lt;=10,</span> </code><strong class="command">c</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;a&quot;,</span> <span class="pre">&quot;b&quot;,</span> <span class="pre">&quot;c&quot;)]</span></code>,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">X[,</span> </code><strong class="command">c</strong><code class="code docutils literal notranslate"><span class="pre">(1,</span> <span class="pre">&quot;b&quot;,</span> <span class="pre">&quot;d&quot;)]</span></code>.</p></li>
</ul>
</div></div><div class="proof proof-type-exercise" id="id53">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.29</span>
        
    </div><div class="proof-content">
<p>Assuming that <code class="docutils literal notranslate"><span class="pre">X</span></code> is an array,
what are the differences between the following indexing schemes?</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">X[&quot;1&quot;,</span> <span class="pre">]</span></code> vs <code class="docutils literal notranslate"><span class="pre">X[1,</span> <span class="pre">]</span></code>,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">X[,</span> <span class="pre">&quot;a&quot;,</span> <span class="pre">&quot;b&quot;,</span> <span class="pre">&quot;c&quot;]</span></code> vs <code class="docutils literal notranslate"><span class="pre">X[&quot;a&quot;,</span> <span class="pre">&quot;b&quot;,</span> <span class="pre">&quot;c&quot;]</span></code> vs
<code class="docutils literal notranslate"><span class="pre">X[,</span> </code><strong class="command">c</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;a&quot;,</span> <span class="pre">&quot;b&quot;,</span> <span class="pre">&quot;c&quot;)]</span></code> vs
<code class="docutils literal notranslate"><span class="pre">X[</span></code><strong class="command">c</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;a&quot;,</span> <span class="pre">&quot;b&quot;,</span> <span class="pre">&quot;c&quot;)]</span></code>,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">X[1]</span></code> vs <code class="docutils literal notranslate"><span class="pre">X[,</span> <span class="pre">1]</span></code> vs <code class="docutils literal notranslate"><span class="pre">X[1,</span> <span class="pre">]</span></code>,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">X[X&gt;0]</span></code> vs <code class="docutils literal notranslate"><span class="pre">X[X&gt;0,</span> <span class="pre">]</span></code> vs <code class="docutils literal notranslate"><span class="pre">X[,</span> <span class="pre">X&gt;0]</span></code>,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">X[X[,</span> <span class="pre">1]&gt;0]</span></code> vs <code class="docutils literal notranslate"><span class="pre">X[X[,</span> <span class="pre">1]&gt;0,]</span></code> vs <code class="docutils literal notranslate"><span class="pre">X[,X[,1]&gt;0]</span></code>,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">X[X[,</span> <span class="pre">1]&gt;5,</span> <span class="pre">X[1,</span> <span class="pre">]&lt;10]</span></code> vs <code class="docutils literal notranslate"><span class="pre">X[X[1,</span> <span class="pre">]&gt;5,</span> <span class="pre">X[,</span> <span class="pre">1]&lt;10]</span></code>.</p></li>
</ul>
</div></div><div class="proof proof-type-exercise" id="id54">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.30</span>
        
    </div><div class="proof-content">
<p>For a given real <em>n</em>-by-<em>m</em> matrix <span class="math notranslate nohighlight">\(\mathbf{X}\)</span>,
determine the bounding hyperrectangle of
thusly encoded <em>n</em> input points in an <em>m</em>-dimensional space.
Return a 2-by-<em>m</em> matrix <span class="math notranslate nohighlight">\(\mathbf{B}\)</span>
with <span class="math notranslate nohighlight">\(b_{1,j}=\min_i x_{i,j}\)</span> and <span class="math notranslate nohighlight">\(b_{2,j}=\max_i x_{i,j}\)</span>.</p>
</div></div><div class="proof proof-type-exercise" id="id55">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.31</span>
        
    </div><div class="proof-content">
<p>Let <span class="math notranslate nohighlight">\(\mathbf{t}\)</span> be vector of <em>n</em> integers in <span class="math notranslate nohighlight">\(\{1,\dots,k\}\)</span>.
Write a function to one-hot-encode each <span class="math notranslate nohighlight">\(t_i\)</span>:
return a 0-1 matrix <span class="math notranslate nohighlight">\(\mathbf{R}\)</span> of size <em>n</em>-by-<em>k</em> such that <span class="math notranslate nohighlight">\(r_{i,j}=1\)</span>
if and only if <span class="math notranslate nohighlight">\(j = t_i\)</span>.
For example, if <span class="math notranslate nohighlight">\(\mathbf{t}=[1, 2, 3, 2, 4]\)</span> and <span class="math notranslate nohighlight">\(k=4\)</span>, then:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\mathbf{R} = \left[
\begin{array}{cccc}
1 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 1 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 1 &amp; 0 \\
0 &amp; 1 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 1 \\
\end{array}
\right].
\end{split}\]</div>
<p>On a side note, such a representation is useful when solving,
e.g., a multiclass classification problem by means of <em>k</em> binary classifiers.</p>
<p>Then, write another function, but this time setting
<span class="math notranslate nohighlight">\(r_{i,j}=1\)</span> if and only if <span class="math notranslate nohighlight">\(j\ge t_i\)</span>, e.g.:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
R = \left[
\begin{array}{cccc}
1 &amp; 1 &amp; 1 &amp; 1 \\
0 &amp; 1 &amp; 1 &amp; 1 \\
0 &amp; 0 &amp; 1 &amp; 1 \\
0 &amp; 1 &amp; 1 &amp; 1 \\
0 &amp; 0 &amp; 0 &amp; 1 \\
\end{array}
\right].
\end{split}\]</div>
</div></div><div class="admonition important">
<p class="admonition-title">Important</p>
<p>Kind reminder: as usual, try to solve
all the exercises without the use of explicit
<strong class="command">for</strong> and <strong class="command">while</strong> loops (provided that it is possible).</p>
</div>
<div class="proof proof-type-exercise" id="id56">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.32</span>
        
    </div><div class="proof-content">
<p>Given an <em>n</em>-by-<em>k</em> real matrix, apply the softmax
function on each row, i.e., map
<span class="math notranslate nohighlight">\(x_{i,j}\)</span> to <span class="math notranslate nohighlight">\(\frac{\exp(x_{i,j})}{\sum_{l=1}^k \exp(x_{i,l})}\)</span>.
Then, one-hot decode the values in each row, i.e., find the
column number with the greatest value. Return a vector of size <em>n</em>
with elements in <span class="math notranslate nohighlight">\(\{1,\dots,k\}\)</span>.</p>
</div></div><div class="proof proof-type-exercise" id="id57">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.33</span>
        
    </div><div class="proof-content">
<p>Assume that an <em>n</em>-by-<em>d</em> real matrix <span class="math notranslate nohighlight">\(\mathbf{X}\)</span> represents
<em>n</em> points in <span class="math notranslate nohighlight">\(\mathbb{R}^d\)</span>. Write a function (but do not refer to
<strong class="command">dist</strong>) that determines the pairwise distances between all
the <em>n</em> points and a given <span class="math notranslate nohighlight">\(\mathbf{y}\in\mathbb{R}^d\)</span>.
Return a vector <span class="math notranslate nohighlight">\(\mathbf{d}\)</span> of length <em>n</em>
with <span class="math notranslate nohighlight">\(d_{i}=\|\mathbf{x}_{i,\cdot}-\mathbf{y}\|_2\)</span>.</p>
</div></div><div class="proof proof-type-exercise" id="id58">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.34</span>
        
    </div><div class="proof-content">
<p>Let <span class="math notranslate nohighlight">\(\mathbf{X}\)</span> and <span class="math notranslate nohighlight">\(\mathbf{Y}\)</span>
be two real-valued matrices of sizes <em>n</em>-by-<em>d</em> and
<em>m</em>-by-<em>d</em>, respectively, representing two sets of points in <span class="math notranslate nohighlight">\(\mathbb{R}^d\)</span>.
Return an integer vector <span class="math notranslate nohighlight">\(\mathbf{r}\)</span> of length <em>m</em>
such that <span class="math notranslate nohighlight">\(r_i\)</span> indicates the index of the
point in <span class="math notranslate nohighlight">\(\mathbf{X}\)</span> with the least distance to (the closest to)
the <em>i</em>-th point in <span class="math notranslate nohighlight">\(\mathbf{Y}\)</span>, i.e.,
<span class="math notranslate nohighlight">\(r_i = \mathrm{arg}\min_j \|\mathbf{x}_{j,\cdot}-\mathbf{y}_{i,\cdot}\|_2\)</span>.</p>
</div></div><div class="proof proof-type-exercise" id="id59">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.35</span>
        
    </div><div class="proof-content">
<p>Write your own version of the built-in <strong class="program">utils</strong>::<strong class="command">combn</strong>.</p>
</div></div><div class="proof proof-type-exercise" id="id60">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.36</span>
        
    </div><div class="proof-content">
<p>Time series are vectors or matrices of class <code class="docutils literal notranslate"><span class="pre">ts</span></code>
equipped with the <code class="docutils literal notranslate"><span class="pre">tsp</span></code> attribute, amongst others.
Refer to <strong class="command">help</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;ts&quot;)</span></code> for more information about
how they are represented and what S3 methods have been overloaded for them.</p>
</div></div><div class="proof proof-type-exercise" id="id61">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.37</span>
        
    </div><div class="proof-content">
<p>(*) Numeric matrices can be stored in a CSV file, amongst others.
Usually, we will be loading them via <strong class="command">read.csv</strong>,
which returns a data frame (see <a class="reference internal" href="240-data-frame.html#chap-data-frame"><span class="std std-numref">Chapter 12</span></a>),
for example:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">&lt;-</span> <span class="nf">as.matrix</span><span class="p">(</span><span class="nf">read.csv</span><span class="p">(</span>
    <span class="nf">paste0</span><span class="p">(</span>
        <span class="s">&quot;https://github.com/gagolews/teaching-data/&quot;</span><span class="p">,</span>
        <span class="s">&quot;raw/master/marek/eurxxx-20200101-20200630.csv&quot;</span>
    <span class="p">),</span>
    <span class="n">comment.char</span><span class="o">=</span><span class="s">&quot;#&quot;</span><span class="p">,</span>
    <span class="n">sep</span><span class="o">=</span><span class="s">&quot;,&quot;</span>
<span class="p">))</span>
</pre></div>
</div>
<p>Write your own function
<strong class="command">read_numeric_matrix</strong><code class="code docutils literal notranslate"><span class="pre">(file_name,</span> <span class="pre">comment,</span> <span class="pre">sep)</span></code>
which is instead based on a few calls to <strong class="command">scan</strong>.
Use <strong class="command">file</strong> to establish a file connection to be able
to ignore the comment lines and fetch the column names
before reading the actual numeric values.</p>
</div></div><div class="proof proof-type-exercise" id="id62">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.38</span>
        
    </div><div class="proof-content">
<p>(*)
Using <strong class="command">readBin</strong>,
read the <code class="file docutils literal notranslate"><span class="pre">t10k-images-idx3-ubyte.gz</span></code>
from the <a class="reference external" href="https://web.archive.org/web/20211107114045/http://yann.lecun.com/exdb/mnist/">MNIST database homepage</a>.
The output object should be a three-dimensional, 10000-by-28-by-28 array
with real elements between 0 and 255.
Refer to the File Formats section therein for more details.</p>
</div></div><div class="proof proof-type-exercise" id="id63">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.39</span>
        
    </div><div class="proof-content">
<p>(**)
Circular convolution of discrete-valued multidimensional signals
can be performed by means
of <strong class="command">fft</strong> and matrix multiplication,
whereas affine transformations require only the latter.
Apply various image transformations such as sharpening,
shearing, and rotating on the MNIST digits
and plot the results using the <strong class="command">image</strong> function.</p>
</div></div><div class="proof proof-type-exercise" id="id64">

    <div class="proof-title">
        <span class="proof-type">Exercise 11.40</span>
        
    </div><div class="proof-content">
<p>(*) Using <strong class="command">constrOptim</strong>,
find the minimum of the Constrained Betts Function
<span class="math notranslate nohighlight">\(f(x_1, x_2) = 0.01 x_1^2 + x_2^2 - 100\)</span>
with linear constraints <span class="math notranslate nohighlight">\( 2\le x_1 \le 50\)</span>,
<span class="math notranslate nohighlight">\(-50 \le x_2 \le 50\)</span>, and <span class="math notranslate nohighlight">\(10 x_1 \ge 10 + x_2\)</span>.
(**) Also, use <strong class="command">solve.QP</strong> from the <strong class="command">quadprog</strong>
package of find the minimum.</p>
</div></div><hr class="footnotes docutils" />
<dl class="footnote brackets">
<dt class="label" id="footsimplify"><span class="brackets"><a class="fn-backref" href="#id2">1</a></span></dt>
<dd><p>Which can easily be explained by the fact that
matrix elements are stored in a columnwise order.</p>
</dd>
<dt class="label" id="footunclass"><span class="brackets"><a class="fn-backref" href="#id3">2</a></span></dt>
<dd><p>Also, note that calling <strong class="command">unclass</strong> on a matrix
has no effect.</p>
</dd>
<dt class="label" id="footsqover"><span class="brackets"><a class="fn-backref" href="#id4">3</a></span></dt>
<dd><p>Hidden deeply at the C language level.</p>
</dd>
<dt class="label" id="footunarymatrix"><span class="brackets"><a class="fn-backref" href="#id5">4</a></span></dt>
<dd><p>They are simply applied on each
element of the underlying flat vector.
In <a class="reference internal" href="150-indexing.html#sec-attrpreserv"><span class="std std-numref">Section 5.5</span></a>, we have mentioned that
unary functions preserve <em>all</em> attributes of their inputs, hence
also <code class="docutils literal notranslate"><span class="pre">dim</span></code> and <code class="docutils literal notranslate"><span class="pre">dimnames</span></code>.</p>
</dd>
<dt class="label" id="footblas"><span class="brackets"><a class="fn-backref" href="#id8">5</a></span></dt>
<dd><p>(*) Note that we can select the underlying implementation
of <strong class="program">BLAS</strong> at R’s compile time; see Section A.3 in
<span id="id21">[<a class="reference internal" href="999-bibliography.html#id9" title="R Development Core Team. (2023).  R Installation and Administration. URL: https://CRAN.R-project.org/doc/manuals/r-release/R-admin.html.">47</a>]</span>. Some of them are faster than others.</p>
</dd>
<dt class="label" id="footcopula"><span class="brackets"><a class="fn-backref" href="#id9">6</a></span></dt>
<dd><p>For drawing random samples from any multivariate distribution,
refer to the theory of copulas, e.g., <span id="id22">[<a class="reference internal" href="999-bibliography.html#id59" title="Nelsen, R.B. (1999).  An Introduction to Copulas. Springer-Verlag.">37</a>]</span>.
There are a few R packages on CRAN that implement the most popular
models.</p>
</dd>
<dt class="label" id="footcomplexqr"><span class="brackets"><a class="fn-backref" href="#id10">7</a></span></dt>
<dd><p><span class="math notranslate nohighlight">\(\mathbf{A}\)</span> can also be a complex matrix,
which results in its QR decomposition’s being
such that <span class="math notranslate nohighlight">\(\mathbf{Q}\)</span> is a unitary matrix.</p>
</dd>
<dt class="label" id="footregsvd"><span class="brackets"><a class="fn-backref" href="#id11">8</a></span></dt>
<dd><p>As the pseudoinverse
<span class="math notranslate nohighlight">\(\mathbf{X}^+=\left(\mathbf{X}^T \mathbf{X} \right)^{-1} \mathbf{X}^T
=\mathbf{V} \mathbf{D}^+ \mathbf{U}^T=\mathbf{R}^{-1}\mathbf{Q}^T\)</span>,
with
<span class="math notranslate nohighlight">\(\mathbf{X}^+ \mathbf{X}=\mathbf{I}\)</span>.
Here <span class="math notranslate nohighlight">\(\mathbf{D}^+\)</span> is a transposed version of <span class="math notranslate nohighlight">\(\mathbf{D}\)</span>
featuring the reciprocals of its non-zero elements.</p>
</dd>
<dt class="label" id="footpcasvd"><span class="brackets"><a class="fn-backref" href="#id12">9</a></span></dt>
<dd><p>See the source code of
<strong class="command">getS3method</strong><code class="code docutils literal notranslate"><span class="pre">(&quot;prcomp&quot;,</span> <span class="pre">&quot;default&quot;)</span></code>.</p>
</dd>
<dt class="label" id="foots3fix1"><span class="brackets"><a class="fn-backref" href="#id13">10</a></span></dt>
<dd><p>A partial solution to this could involve defining
a method like <strong class="command">validate.class_name</strong>, that is called
frequently and which checks whether a given object enjoys
some desired constraints.</p>
</dd>
<dt class="label" id="footmutdis"><span class="brackets"><a class="fn-backref" href="#id14">11</a></span></dt>
<dd><p>Although there are functions featuring some workarounds
(see, e.g., <strong class="command">cbind</strong> which dispatches to
<strong class="command">cbind.data.frame</strong> if one argument is a data frame
and the remaining ones are vectors or matrices).
Also, binary operators overloaded via group generics
consider the classes of both operands; see <a class="reference internal" href="350-eval-fun.html#sec-group-generics"><span class="std std-numref">Section 18.4</span></a>.</p>
</dd>
<dt class="label" id="foots3fix2"><span class="brackets"><a class="fn-backref" href="#id15">12</a></span></dt>
<dd><p>Hypothetically, we can imagine an OOP system
relying on methods named like <strong class="command">method.class_name1.class_name2</strong>
where dispatching is based on two argument types.</p>
</dd>
</dl>
</section>
</section>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="240-data-frame.html" class="btn btn-neutral float-right" title="12. Data Frames" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="220-s3.html" class="btn btn-neutral float-left" title="10. S3 Classes" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        Copyright &#169; 2022–2023 by <a href="https://www.gagolewski.com">Marek Gagolewski</a>. Some rights reserved. Licensed under <a href='https://creativecommons.org/licenses/by-nc-nd/4.0/'>CC BY-NC-ND 4.0</a>.

    Built with <a href="https://sphinx-doc.org/">Sphinx</a>
    and a customised <a href="https://github.com/rtfd/sphinx_rtd_theme">rtd</a>
    theme.
      <span class="lastupdated">
        Last updated on 2022-12-29T11:22:44+1100.
      </span>


    This site will never display any ads: it is a non-profit project.
    It does not collect any data.

    </p>
  </div> 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>